<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0c10">
    <title>Belajar Bersama - Professional Cross-Platform App</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React & Lucide Icons via CDN -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Global Error Handler -->
    <script>
        window.onerror = function (msg, url, line, col, error) {
            // Ignore benign ResizeObserver error
            if (msg.includes('ResizeObserver')) return false;

            const errorContainer = document.getElementById('error-container');
            if (errorContainer) {
                errorContainer.innerText = "Error: " + msg + " (Lines " + line + ")";
                errorContainer.style.display = 'block';
            }
            return false;
        };
    </script>

    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --bg-main: #0a0c10;
            --bg-card: #161b22;
            --text-white: #f0f6fc;
            --text-gray: #8b949e;
            --border: #30363d;
            --glass: rgba(22, 27, 34, 0.95);
            --sidebar-width: 260px;

            /* Responsive Tokens */
            --container-max: 1400px;
            --radius-lg: 24px;
            --radius-md: 16px;
            --gap-responsive: clamp(16px, 4vw, 32px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body {
            background: #111;
            color: var(--text-white);
            font-family: 'Outfit', sans-serif;
            overflow: hidden;
        }

        #root {
            width: 100%;
            min-height: 100vh;
            background: var(--bg-main);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- Responsive Spacing & Grid System --- */
        .container {
            width: 100%;
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 var(--gap-responsive);
        }

        .grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(150px, 25vw, 300px), 1fr));
            gap: clamp(12px, 3vw, 24px);
            width: 100%;
        }

        /* Responsive paddings */
        .section-p {
            padding: clamp(20px, 6vw, 40px) 0;
        }

        .content-gap {
            gap: var(--gap-responsive);
        }

        .page-header {
            padding: clamp(30px, 6vw, 50px) var(--gap-responsive);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            position: relative;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Sidebar Layout (Global) */
        .sidebar-page-container {
            display: flex;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            flex-direction: column;
            /* Mobile first: Stacked */
        }

        .app-sidebar {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            flex-shrink: 0;
            z-index: 10;
            scrollbar-width: none;
            /* Firefox */
        }

        .app-sidebar::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .sidebar-header {
            display: none;
        }

        .sidebar-menu {
            display: flex;
            gap: 8px;
            width: 100%;
        }

        .sidebar-menu button {
            flex: 1;
            min-width: fit-content;
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-size: 13px;
            white-space: nowrap;
        }

        .sidebar-menu button.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .app-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            padding-bottom: 140px;
            /* Jarak aman agar tidak tertutup nav bar */
            position: relative;
        }

        .mobile-header {
            margin-bottom: 24px;
            display: block;
        }

        /* --- Advanced Scrolling & Scrollbar System --- */
        html {
            scroll-behavior: smooth;
        }

        /* Container Scroll Area dengan Batasan Tinggi */
        .content-scroll-area {
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            /* Momentum scroll iOS */

            /* Responsive Max Height calculations */
            max-height: calc(100vh - 400px);
            /* Mobile Default */

            /* Visuals */
            padding-right: 4px;
            /* Space for scrollbar */
            scrollbar-color: var(--primary) rgba(255, 255, 255, 0.05);
            scrollbar-width: thin;
        }

        /* Desktop Scrollbar Styling */
        @media (min-width: 1024px) {
            .content-scroll-area {
                max-height: calc(100vh - 420px);
            }

            /* Custom Scrollbar PC */
            ::-webkit-scrollbar {
                width: 10px;
                background: rgba(0, 0, 0, 0.2);
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(to bottom, var(--primary), var(--secondary));
                border-radius: 5px;
                border: 2px solid rgba(0, 0, 0, 0.2);
                /* Creates padding effect */
            }

            ::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.02);
                border-radius: 5px;
            }
        }

        /* Tablet Scrollbar Styling */
        @media (min-width: 768px) and (max-width: 1023px) {
            .content-scroll-area {
                max-height: calc(100vh - 380px);
            }
        }

        /* Mobile Scrollbar Styling */
        @media (max-width: 767px) {

            /* Scrollbar tipis/tersembunyi di mobile */
            ::-webkit-scrollbar {
                width: 6px;
                background: transparent;
            }

            ::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
            }

            /* Hide scrollbar when not interacting if supported */
            .content-scroll-area {
                scrollbar-width: none;
                /* Firefox mobile */
            }
        }

        /* Horizontal Scroll Utility (Updated) */
        .horizontal-scroll {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            /* Hide for cleanliness */
        }

        .horizontal-scroll::-webkit-scrollbar {
            display: none;
        }

        @media (min-width: 768px) {
            .sidebar-page-container {
                flex-direction: row;
            }

            .app-sidebar {
                width: 260px;
                height: 100%;
                flex-direction: column;
                border-right: 1px solid var(--border);
                border-bottom: none;
                gap: 24px;
                padding: 24px;
            }

            .sidebar-header {
                display: block;
                padding-bottom: 20px;
                border-bottom: 1px solid var(--border);
            }

            .sidebar-header h2 {
                font-size: 20px;
                color: white;
                margin-bottom: 4px;
            }

            .sidebar-header p {
                font-size: 12px;
                color: var(--text-gray);
            }

            .sidebar-menu {
                flex-direction: column;
                width: 100%;
            }

            .sidebar-menu button {
                justify-content: flex-start;
                padding: 14px 16px;
                font-size: 14px;
            }

            .mobile-header {
                display: none;
            }
        }

        /* --- Components --- */
        header {
            padding: 30px 24px 10px;
        }

        .search-bar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .search-bar:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            outline: none;
            width: 100%;
            font-family: inherit;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* --- 3D Atmospheric Backgrounds --- */
        .page-container-3d {
            position: relative;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            background: #0a0c10;
            scroll-behavior: smooth;
            padding-bottom: 140px;
            /* Jarak aman agar tidak tertutup nav bar */
        }

        .bg-blob {
            position: fixed;
            width: clamp(300px, 60vw, 600px);
            height: clamp(300px, 60vw, 600px);
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.15;
            pointer-events: none;
            animation: moveBlob 20s infinite alternate;
        }

        @keyframes moveBlob {
            0% {
                transform: translate(-10%, -10%) rotate(0deg) scale(1);
            }

            100% {
                transform: translate(20%, 20%) rotate(360deg) scale(1.2);
            }
        }

        .blob-1 {
            top: -10%;
            left: -10%;
            background: var(--primary);
        }

        .blob-2 {
            bottom: -10%;
            right: -10%;
            background: var(--secondary);
            animation-delay: -5s;
        }

        .blob-3 {
            top: 40%;
            right: -5%;
            background: #10B981;
            animation-delay: -10s;
            opacity: 0.1;
        }

        .mesh-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            perspective: 1000px;
            transform: rotateX(60deg) translateY(-200px);
            mask-image: linear-gradient(to bottom, transparent, black, transparent);
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
        }

        .glass-panel-3d {
            position: relative;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            opacity: 0;
            transition: 0.2s;
        }

        .card:hover::before {
            opacity: 1;
        }

        .tag {
            font-size: 11px;
            font-weight: 500;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            margin-right: 6px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        /* --- Enhanced Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(22, 27, 34, 0.85);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        .sidebar {
            display: none;
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.9) 0%, rgba(10, 12, 16, 0.98) 100%);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 40px 24px;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        .main-content {
            flex: 1;
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
            width: 100%;
            transition: padding 0.3s ease;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--text-gray);
            font-size: 10px;
            cursor: pointer;
            padding: 12px;
            border-radius: 18px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
        }

        .nav-item i {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            font-weight: 700;
            scale: 1.05;
        }

        /* --- Menu Colors --- */
        .nav-item[data-menu="home"].active {
            color: #818cf8;
            background: rgba(129, 140, 248, 0.15);
        }

        .nav-item[data-menu="bidang"].active {
            color: #fb7185;
            background: rgba(251, 113, 133, 0.15);
        }

        .nav-item[data-menu="pesan"].active {
            color: #34d399;
            background: rgba(52, 211, 153, 0.15);
        }

        .nav-item[data-menu="anggota"].active {
            color: #fbbf24;
            background: rgba(251, 191, 36, 0.15);
        }

        .nav-item[data-menu="notif"].active {
            color: #f87171;
            background: rgba(248, 113, 113, 0.15);
        }

        .nav-item[data-menu="profil"].active {
            color: #a78bfa;
            background: rgba(167, 139, 250, 0.15);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0px;
            width: 20px;
            height: 3px;
            background: currentColor;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 0 15px currentColor;
        }

        .nav-item.active i {
            transform: translateY(-2px);
            filter: drop-shadow(0 4px 8px currentColor);
        }

        .fab {
            position: fixed;
            bottom: 100px;
            right: 24px;
            z-index: 99;
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
            cursor: pointer;
            transition: 0.3s;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
        }

        /* --- 3D Bidang Cards --- */
        .bidang-card {
            perspective: 1200px !important;
            background: linear-gradient(145deg, rgba(22, 27, 34, 0.8), rgba(22, 27, 34, 1)) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
            padding: 30px 20px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            height: auto !important;
            width: 100% !important;
            margin: 0 !important;
        }

        .bidang-card:hover {
            transform: translateY(-8px) rotateX(4deg) !important;
            border-color: var(--primary) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4) !important;
        }

        .icon-container-3d {
            width: 80px;
            height: 80px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }

        .bidang-card:hover .icon-container-3d {
            transform: translateZ(30px) rotateY(10deg);
        }

        .icon-box {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            z-index: 5;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .bidang-card:hover .icon-box {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.2);
            scale: 1.1;
        }

        .icon-shadow-3d {
            position: absolute;
            bottom: -5px;
            width: 50px;
            height: 12px;
            background: var(--glow-color);
            border-radius: 50%;
            filter: blur(15px);
            opacity: 0.4;
            transform: rotateX(90deg) translateZ(-40px);
            transition: 0.3s;
            z-index: 1;
        }

        .bidang-card:hover .icon-shadow-3d {
            opacity: 0.8;
            filter: blur(12px);
            scale: 1.4;
        }

        .category-glow-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, var(--glow-color) 0%, transparent 70%);
            opacity: 0.05;
            z-index: 0;
            transition: 0.4s;
            pointer-events: none;
        }

        .bidang-card:hover .category-glow-bg {
            opacity: 0.15;
            scale: 1.2;
        }

        /* --- Multi-Platform Desktop Responsive --- */
        @media (min-width: 768px) {
            #root {
                flex-direction: row;
                padding-left: var(--sidebar-width);
                position: relative;
            }

            /* Remove sidebar padding when Auth/Splash screen is present */
            /* Remove sidebar padding when Auth/Splash screen is present */
            body:has(.auth-screen) #root,
            body:has(.splash-screen) #root,
            body:has(.onboarding-screen) #root {
                padding-left: 0 !important;
                padding-top: 0 !important;
                /* Force reset top padding */
                justify-content: center !important;
                align-items: center !important;
                /* Force vertical center */
                height: 100vh !important;
            }

            .bottom-nav {
                display: none;
            }

            .sidebar {
                display: flex;
                box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
            }

            .main-content {
                padding-bottom: 40px;
                padding-top: 0;
                width: 100%;
                min-height: 100vh;
            }

            /* Reset padding bottom for desktop since nav bar is hidden */
            .page-container-3d,
            .app-content {
                padding-bottom: 40px !important;
            }

            .nav-item {
                flex-direction: row;
                font-size: 15px;
                gap: 16px;
                padding: 14px 20px;
                margin-bottom: 10px;
                width: 100%;
                justify-content: flex-start;
                border-radius: 14px;
            }

            .nav-item.active::after {
                bottom: auto;
                left: -24px;
                width: 4px;
                height: 24px;
                border-radius: 0 4px 4px 0;
            }

            .nav-item i {
                font-size: 22px;
                width: 24px;
                height: 24px;
            }

            .fab {
                bottom: 40px;
                right: 40px;
                width: 64px;
                height: 64px;
            }

            /* Improve Grid Layouts */
            .grid-container {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 24px;
                max-width: 1200px;
                /* Layout Limit */
                margin: 0 auto;
            }

            .favorites-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
                gap: 20px !important;
            }
        }

        /* --- Splash & Auth (Keep specific screens centered and mobile-width) --- */
        .splash-screen,
        .onboarding-screen,
        .auth-screen {
            min-height: 100vh !important;
            width: 100% !important;
            z-index: 9999 !important;
            overflow: hidden !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 20px !important;
        }

        .auth-container {
            margin: 0 auto;
            max-width: 340px;
        }

        @keyframes shine {
            0% {
                left: -50px;
                opacity: 0;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                left: 120%;
                opacity: 0;
            }
        }

        /* --- Mobile Optimizations (Maximal Responsiveness) --- */
        html,
        body {
            overscroll-behavior-y: none;
            /* Prevent pull-to-refresh */
            touch-action: pan-x pan-y;
            -webkit-tap-highlight-color: transparent;
        }

        .db-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #2b2b2b;
            z-index: 50000;
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', sans-serif;
            color: #ccc;
        }

        .db-layout {
            display: flex;
            flex: 1;
            flex-direction: row;
            overflow: hidden;
        }

        .db-sidebar {
            width: 250px;
            background: #313335;
            border-right: 1px solid #111;
            display: flex;
            flex-direction: column;
        }

        .db-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #2b2b2b;
        }

        @media (max-width: 768px) {
            .db-layout {
                flex-direction: column;
            }

            .db-sidebar {
                width: 100%;
                height: 40%;
                min-height: 200px;
                border-right: none;
                border-bottom: 1px solid #111;
            }

            .db-editor {
                height: 60%;
            }

            .bidang-card {
                min-height: 140px;
            }

            /* Ensure touch target size */
            .logo-container {
                width: 80px !important;
                height: 80px !important;
            }

            /* Smaller logo on mobile sidebar if shown */
        }
    </style>
</head>

<body>
    <div id="error-container"
        style="background: #333; color: #ff6b6b; padding: 20px; display: none; margin: 20px; border-radius: 8px; font-family: monospace;">
    </div>
    <div id="root">
        <div style="color: #666; font-family: sans-serif; text-align: center; padding-top: 50px;">
            <h2>Memuat Aplikasi...</h2>
            <p>Jika halaman ini tidak berubah dalam 10 detik, cek koneksi internet Anda.</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- UI COMPONENTS ---
        const Icon = ({ name, size = 20, color = "currentColor" }) => {
            useEffect(() => {
                if (typeof lucide !== 'undefined' && lucide.createIcons) {
                    lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size, color }}></i>;
        };

        // Utility: Robust Share Function
        const globalShare = async (data) => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: data.title,
                        text: data.text,
                        url: data.url || window.location.href
                    });
                } catch (err) {
                    if (err.name !== 'AbortError') console.error('Share failed:', err);
                }
            } else {
                const shareText = `${data.title}\n${data.text}\n${data.url || window.location.href}`;
                try {
                    await navigator.clipboard.writeText(shareText);
                    alert('âœ“ Berhasil disalin ke clipboard! Siap dibagikan.');
                } catch (err) {
                    alert('Gagal menyalin. Silakan salin link secara manual.');
                }
            }
        };

        const QuestionCard = ({ user, title, tags, comments = 0, onReply, onAddColleague }) => {
            return (
                <div className="card animate">
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>
                        <div style={{ width: 36, height: 36, borderRadius: '50%', background: 'linear-gradient(45deg, #6366f1, #ec4899)' }}></div>
                        <div>
                            <div style={{ fontSize: '14px', fontWeight: '600' }}>{user}</div>
                            <div style={{ fontSize: '11px', color: 'var(--text-gray)' }}>Baru saja</div>
                        </div>
                    </div>
                    <div style={{ fontSize: '16px', fontWeight: '700', marginBottom: '8px' }}>{title}</div>
                    <div style={{ display: 'flex', gap: '4px', marginBottom: '12px' }}>
                        {tags.map(t => <span key={t} className="tag" style={{ textTransform: 'uppercase', fontSize: '10px' }}>{t}</span>)}
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '16px', paddingTop: '12px', borderTop: '1px solid rgba(255,255,255,0.05)' }}>
                        <div onClick={onReply} style={{ display: 'flex', alignItems: 'center', gap: '6px', color: 'var(--primary)', fontSize: '12px', cursor: 'pointer', fontWeight: '600' }}>
                            <Icon name="message-circle" size={16} />
                            <span>{comments} Balasan</span>
                        </div>
                        <div onClick={onAddColleague} style={{ display: 'flex', alignItems: 'center', gap: '6px', color: 'var(--text-gray)', fontSize: '12px', cursor: 'pointer' }}>
                            <Icon name="user-plus" size={16} />
                            <span>Ikut Serta</span>
                        </div>
                        <div onClick={(e) => { e.stopPropagation(); globalShare({ title: 'Diskusi IT', text: `Yuk bantu jawab diskusi ini: "${title}"` }); }} style={{ display: 'flex', alignItems: 'center', gap: '6px', color: 'var(--text-gray)', fontSize: '12px', cursor: 'pointer', marginLeft: 'auto' }}>
                            <Icon name="share-2" size={16} />
                        </div>
                    </div>
                </div>
            );
        };

        const KNOWLEDGE_BASE = [
            {
                id: 'wifi', icon: 'wifi-off', color: '#3B82F6',
                title: "Masalah Koneksi WiFi Kantor pada Windows 11",
                trendInfo: "Muncul 12x di Grup Diskusi hari ini",
                question: "Kenapa banyak laptop karyawan tidak bisa terkoneksi ke WiFi kantor (SSID: Kantor_Utama) setelah menjalankan update Windows 11 versi 23H2 secara massal?",
                desc: "Evaluasi Otomatis: Gagal autentikasi protokol WPA3 pada infrastruktur legacy.",
                aiCrawling: "AI mendeteksi lonjakan diskusi di 12 forum IT internasional. Analisa pola menunjukkan kegagalan pada lapisan 'WLAN AutoConfig Service'. AI telah merangkum analisa dari 50+ laporan troubleshooting serupa dalam 24 jam terakhir.",
                googleInsight: "Google Search Data Highlights: \n- Trending Keywords: 'Windows 11 KB503 WiFi issue'\n- Top Reference: Microsoft Official Thread ID #9921 memvalidasI adanya bug driver pada chip Intel AX seri-AX.\n- Solusi Terpopuler di Google: Rolling back driver atau menonaktifkan fitur 802.11ax di properti adapter.",
                analysis: "Hasil Evaluasi Gabungan (Google Support & Deep-AI): \n\n**Akar Masalah:** \nKetidakcocokan power management chip WiFi Windows 11 dengan standar 802.11ax. Terdeteksi 85% kegagalan terjadi pada Access Point seri-H. \n\n**Langkah Pemecahan:** \n1. Buka Device Manager > Network Adapters. \n2. Pilih Driver WiFi > Properties > Power Management. \n3. Hilangkan centang pada 'Allow computer to turn off this device'. \n4. Paksa update driver ke versi Enterprise 22.40.1."
            },
            {
                id: 'node', icon: 'server', color: '#10B981',
                title: "Error Runtime: Heap Out of Memory di Node.js",
                trendInfo: "Isu Populer di Bidang Backend",
                question: "Aplikasi backend HRIS tiba-tiba crash dengan pesan 'v8: Fatal error in manages heap' saat melakukan proses export database tahunan.",
                desc: "Evaluasi Otomatis: Kebocoran memori pada proses asinkronus skala besar.",
                aiCrawling: "AI menscan repository internal dan forum StackOverflow. Terdeteksi adanya loop tak berujung (infinity loop) pada modul 'excel-export-service'. AI menyarankan penggunaan stream API untuk data besar.",
                googleInsight: "Google Search Data Highlights: \n- Trending Keywords: 'Nodejs heap out of memory export large csv'\n- Top Reference: Node.js Documentation Section 'Memory Management'.\n- Forum Suggestion: Meningkatkan limit memory V8 menggunakan flag --max-old-space-size.",
                analysis: "Analisa Komprehensif AI + Google Cloud Logging: \n\n**Akar Masalah:** \nPenumpukan Zombie Objects pada event loop akibat closure yang tidak di-release. Terdeteksi kebocoran pada file `socket-handler.js`. \n\n**Langkah Pemecahan:** \n1. Jalankan aplikasi dengan flag `--max-old-space-size=4096`. \n2. Tambahkan `global.gc()` pada bagian krusial proses. \n3. Lakukan audit memori menggunakan `node-inspect` untuk menemukan referensi sirkular."
            },
            {
                id: 'printer', icon: 'printer', color: '#F59E0B',
                title: "Konflik Driver Printer HP di MacOS Sonoma",
                trendInfo: "Trend di Bidang Hardware",
                question: "User melaporkan printer HP LaserJet tidak terdeteksi di MacOS Sonoma padahal kabel USB sudah terhubung dengan baik.",
                desc: "Evaluasi Otomatis: Isu kompatibilitas AirPrint pada Apple Silicon.",
                aiCrawling: "AI memantau rilis driver terbaru dari vendor HP dan Apple Support. Terdeteksi bahwa MacOS Sonoma menghapus dukungan untuk driver arsitektur x86 lama.",
                googleInsight: "Google Search Data Highlights: \n- Trending Keywords: 'MacOS Sonoma HP printer driver missing'\n- Top Reference: Apple Communities thread tentang 'Legacy Printer Support removed'.\n- Google Solution: Menggunakan Generic PostScript Driver atau aplikasi HP Smart.",
                analysis: "Hasil Crawling Google Support & AI Analysis: \n\n**Akar Masalah:** \nMacOS Sonoma memblokir legacy driver extensions (KEXT) demi keamanan. Modul HP Utility versi lama tidak memiliki signature yang valid. \n\n**Langkah Pemecahan:** \n1. Uninstal semua driver HP lama dari System Settings. \n2. Download HP Smart App versi terbaru dari App Store. \n3. Tambahkan printer secara manual menggunakan protokol 'IP Printing' (JetDirect-Socket)."
            },
            {
                id: 'security', icon: 'shield-alert', color: '#EF4444',
                title: "Deteksi Unauthorized Login Attempt di VPN",
                trendInfo: "Peringatan Keamanan Sistem",
                question: "Terdeteksi 100+ percobaan login gagal dari IP luar negeri pada dashboard admin VPN dalam waktu 10 menit.",
                desc: "Evaluasi Otomatis: Pola serangan brute-force terdeteksi pada gateway.",
                aiCrawling: "AI mengintegrasikan data dari database ancaman global (Threat Intel). Terdeteksi IP penyerang berasal dari botnet yang sedang aktif menyerang infrastruktur VPN serupa di Asia Tenggara.",
                googleInsight: "Google Search Data Highlights: \n- Trending Keywords: 'CVE-2024 VPN brute force attack'\n- Top Reference: Fortinet Security Advisory.\n- Google Solution: Mengaktifkan Geo-Blocking dan rate limiting IP.",
                analysis: "Analisa Keamanan AI Terintegrasi Security-Cloud: \n\n**Akar Masalah:** \nUpaya login berulang dari 15 IP publik berbeda dalam rentang waktu 5 menit. Terindikasi sebagai serangan Credential Stuffing. \n\n**Langkah Pemecahan:** \n1. Blokir range IP penyerang pada level Firewall gateway. \n2. Aktifkan wajib Multi-Factor Authentication (MFA) untuk semua akun VPN. \n3. Lakukan sinkronisasi ulang kredensial via Active Directory."
            }
        ];

        const REGISTERED_MEMBERS = [
            { id: 1, name: 'Budi Santoso', role: 'IT Support Senior', image: 'https://i.pravatar.cc/150?u=1' },
            { id: 2, name: 'Siti Aminah', role: 'Database Admin', image: 'https://i.pravatar.cc/150?u=2' },
            { id: 3, name: 'Ahmad Rizky', role: 'Network Engineer', image: 'https://i.pravatar.cc/150?u=3' },
            { id: 4, name: 'Dewi Lestari', role: 'Software Developer', image: 'https://i.pravatar.cc/150?u=4' },
            { id: 5, name: 'Rudi Hermawan', role: 'Security Analyst', image: 'https://i.pravatar.cc/150?u=5' }
        ];

        // --- PAGES ---

        // Splash Screen
        const Splash = ({ onFinish }) => {
            useEffect(() => {
                const timer = setTimeout(() => onFinish(), 2500);
                return () => clearTimeout(timer);
            }, [onFinish]);

            return (
                <div className="splash-screen animate" style={{
                    background: 'radial-gradient(circle at center, #1a1c23 0%, #000000 100%)',
                    perspective: '1000px'
                }}>
                    <style>
                        {`
                        @keyframes float {
                            0% { transform: translateY(0px) rotateX(0deg); }
                            50% { transform: translateY(-20px) rotateX(5deg); }
                            100% { transform: translateY(0px) rotateX(0deg); }
                        }
                        @keyframes pulse-glow {
                            0% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.1); }
                            50% { box-shadow: 0 0 100px rgba(255, 215, 0, 0.3); }
                            100% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.1); }
                        }
                        `}
                    </style>
                    <div style={{
                        position: 'relative',
                        animation: 'float 4s ease-in-out infinite'
                    }}>
                        {/* Main Logo Container */}
                        <div style={{
                            width: 'clamp(250px, 70vw, 350px)',
                            height: 'auto',
                            minHeight: '250px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            animation: 'pulse-glow 3s infinite',
                            position: 'relative',
                            zIndex: 2,
                            padding: '20px'
                        }}>
                            <img src="MR.png" alt="MR Tech Logo" style={{
                                width: '100%',
                                height: 'auto',
                                objectFit: 'contain',
                                filter: 'drop-shadow(0 0 30px rgba(255, 215, 0, 0.4))', // Enhanced Gold Glow
                                transform: 'translateZ(50px)'
                            }} />

                            {/* Subtle Shine Overlay (Optional, adjusted for non-circle) */}
                            <div style={{
                                position: 'absolute',
                                top: 0, left: 0, right: 0, bottom: 0,
                                background: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1), transparent 70%)',
                                pointerEvents: 'none',
                                mixBlendMode: 'overlay'
                            }}></div>
                        </div>

                        {/* Reflection Shadow */}
                        <div style={{
                            width: '80%',
                            height: 20,
                            background: 'radial-gradient(ellipse at center, rgba(255, 215, 0, 0.3) 0%, transparent 70%)',
                            position: 'absolute',
                            bottom: -50,
                            left: '10%',
                            borderRadius: '50%',
                            filter: 'blur(10px)',
                            transform: 'scaleY(0.5)',
                            opacity: 0.6,
                            animation: 'pulse-glow 3s infinite reverse'
                        }}></div>
                    </div>
                </div>
            );
        };

        // Onboarding Screens
        const onboardingData = [
            { title: 'SOLUSI\nIT SUPPORT', desc: 'Temukan jawaban dari masalah troubleshooting IT di tempat kerja Anda', icon: 'wrench' },
            { title: 'TANYA JAWAB\nKREDIBEL', desc: 'Dapatkan jawaban valid dari karyawan ahli di berbagai bidang IT', icon: 'check-circle' },
            { title: 'DISKUSI BERSAMA\nREKAN KERJA', desc: 'Berdiskusi dan berbagi solusi dengan sesama karyawan', icon: 'users' }
        ];

        const Onboarding = ({ step, onNext }) => {
            const data = onboardingData[step];

            // Inline styles for the responsive layout
            const styles = {
                container: {
                    width: '100%',
                    height: '100vh',
                    display: 'flex',
                    flexDirection: 'column', // Mobile default: Vertical Stack
                    position: 'relative',
                    overflow: 'hidden',
                    background: '#0a0c10'
                },
                // Visual Side (Top on Mobile, Left on Desktop)
                visualSide: {
                    flex: 1,
                    position: 'relative',
                    background: 'linear-gradient(to bottom, rgba(10, 12, 16, 0.4), rgba(10, 12, 16, 0.9)), url("RAMA.jpeg")',
                    backgroundSize: 'cover',
                    backgroundPosition: 'center',
                    backgroundRepeat: 'no-repeat',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    transition: 'all 0.5s cubic-bezier(0.23, 1, 0.32, 1)'
                },
                // Content Side (Bottom on Mobile, Right on Desktop)
                contentSide: {
                    padding: '40px',
                    display: 'flex',
                    flexDirection: 'column',
                    justifyContent: 'flex-end', // Mobile: text at bottom
                    zIndex: 10,
                    transition: 'all 0.5s ease'
                },
                // Desktop Overrides (Applied via class-like conditional logic in JSX slightly limited, so using media query style block)
            };

            return (
                <div className="onboarding-screen animate" style={{
                    padding: 0,
                    display: 'flex',
                    width: '100%',
                    height: '100vh',
                    overflow: 'hidden'
                }}>
                    <style>
                        {`
                        .onboarding-layout {
                            display: flex;
                            flex-direction: column;
                            width: 100%;
                            height: 100%;
                            background: #0a0c10;
                        }
                        /* --- Mobile: Vertical Stack (Image Top, Content Bottom) --- */
                        .onboarding-visual {
                            flex: 1; /* Takes remaining space */
                            width: 100%;
                            /* 'center top' ensures face is visible if it's a portrait */
                            background: linear-gradient(to bottom, rgba(10, 12, 16, 0.1), rgba(10, 12, 16, 1)), url("RAMA.jpeg");
                            background-size: cover;
                            background-position: center top; 
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            position: relative;
                            min-height: 50%; /* Ensure image gets at least 50% screen */
                        }
                        .onboarding-content-panel {
                            position: relative; /* No longer absolute/overlay */
                            width: 100%;
                            padding: 30px 24px 40px; /* More bottom padding for safe area */
                            background: #0a0c10; /* Solid background */
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: flex-start;
                            z-index: 10;
                            box-shadow: 0 -20px 40px rgba(0,0,0,0.5); /* Shadow to blend upwards */
                        }
                        
                        /* --- Desktop: Split Row (Side-by-Side) --- */
                        @media (min-width: 768px) {
                            .onboarding-layout {
                                flex-direction: row;
                            }
                            .onboarding-visual {
                                flex: 1.2;
                                height: 100%; /* Full height */
                                background: linear-gradient(to right, rgba(10, 12, 16, 0.2), rgba(10, 12, 16, 0.8)), url("RAMA.jpeg");
                                background-size: cover;
                                background-position: center top;
                                border-right: 1px solid rgba(255,255,255,0.05);
                                order: 1; 
                            }
                            .onboarding-content-panel {
                                flex: 1;
                                height: 100%; /* Full height */
                                background: var(--bg-card);
                                padding: 60px;
                                justify-content: center;
                                border-left: 1px solid var(--border);
                                order: 2; 
                                background: #0a0c10;
                                box-shadow: none;
                            }
                            .onboarding-title {
                                font-size: 42px !important;
                                text-align: left !important;
                                align-self: flex-start;
                            }
                            .onboarding-desc {
                                text-align: left !important;
                                font-size: 18px !important;
                                align-self: flex-start;
                                max-width: 450px;
                                margin-bottom: 40px !important;
                            }
                            .onboarding-btn-wrapper {
                                margin-top: 20px;
                                width: 100%;
                                display: flex;
                                justify-content: flex-start;
                            }
                            .step-indicator {
                                justify-content: flex-start !important;
                                margin-bottom: 40px !important;
                            }
                            .visual-icon-wrapper {
                                width: 180px !important;
                                height: 180px !important;
                            }
                        }
                        `}
                    </style>

                    <div className="onboarding-layout">
                        {/* Left/Top Visual Panel */}
                        <div className="onboarding-visual">
                            {/* Floating 3D Icon */}
                            <div className="visual-icon-wrapper animate" style={{
                                width: '120px',
                                height: '120px',
                                background: 'rgba(255,255,255,0.05)',
                                backdropFilter: 'blur(20px)',
                                borderRadius: '50%',
                                display: 'flex', alignItems: 'center', justifyContent: 'center',
                                boxShadow: '0 20px 60px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.1)',
                                transform: 'translateY(-20px)',
                                transition: 'all 0.5s cubic-bezier(0.23, 1, 0.32, 1)'
                            }}>
                                <div style={{
                                    filter: 'drop-shadow(0 0 20px rgba(99, 102, 241, 0.6))',
                                    animation: 'float 3s ease-in-out infinite'
                                }}>
                                    <Icon name={data.icon} size={60} color="white" />
                                </div>
                            </div>
                        </div>

                        {/* Right/Bottom Content Panel */}
                        <div className="onboarding-content-panel">
                            {/* Step Dots */}
                            <div className="step-indicator" style={{ display: 'flex', gap: 8, marginBottom: 20, width: '100%', justifyContent: 'center' }}>
                                {[0, 1, 2].map(i => (
                                    <div key={i} style={{
                                        width: i === step ? 32 : 8, height: 8, borderRadius: 4,
                                        background: i === step ? 'var(--primary)' : 'rgba(255,255,255,0.2)',
                                        transition: 'all 0.3s cubic-bezier(0.23, 1, 0.32, 1)'
                                    }} />
                                ))}
                            </div>

                            <h1 className="onboarding-title" style={{
                                fontSize: '32px', fontWeight: 800, marginBottom: 16, lineHeight: 1.2, width: '100%', textAlign: 'center'
                            }}>
                                {data.title}
                            </h1>

                            <p className="onboarding-desc" style={{
                                color: 'var(--text-gray)', fontSize: '15px', lineHeight: 1.6, marginBottom: 30, width: '100%', textAlign: 'center', opacity: 0.8
                            }}>
                                {data.desc}
                            </p>

                            <div className="onboarding-btn-wrapper" style={{ width: '100%' }}>
                                <button onClick={onNext} style={{
                                    width: '100%',
                                    padding: '18px',
                                    background: step === 2
                                        ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)'
                                        : 'rgba(255,255,255,0.1)',
                                    border: step === 2 ? 'none' : '1px solid rgba(255,255,255,0.1)',
                                    borderRadius: '16px',
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 10,
                                    boxShadow: step === 2 ? '0 10px 30px rgba(99, 102, 241, 0.4)' : 'none',
                                    transition: 'all 0.3s ease'
                                }}>
                                    {step === 2 ? 'Mulai Sekarang' : 'Lanjut'}
                                    <Icon name={step === 2 ? "rocket" : "arrow-right"} size={18} />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Auth Screen
        const Auth = ({ onLogin }) => {
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [isLogin, setIsLogin] = useState(false);
            const [socialType, setSocialType] = useState(null); // 'google' or 'microsoft'

            // Force full width centering by removing sidebar padding
            useEffect(() => {
                const root = document.getElementById('root');
                const originalStyle = root.style.paddingLeft;

                // Force reset padding
                root.style.paddingLeft = '0px';
                root.style.justifyContent = 'center';

                return () => {
                    // Restore on cleanup
                    root.style.paddingLeft = '';
                    root.style.justifyContent = ''; // Reset to default
                };
            }, []);

            const inputStyle = {
                width: '100%',
                padding: '16px 16px 16px 48px',
                background: 'rgba(255,255,255,0.05)',
                border: '1px solid rgba(255,255,255,0.1)',
                borderRadius: 14,
                color: 'white',
                fontSize: 15,
                fontFamily: 'inherit',
                transition: 'all 0.3s ease',
                outline: 'none'
            };

            const labelIconStyle = {
                position: 'absolute',
                left: 16,
                top: '50%',
                transform: 'translateY(-50%)',
                fontSize: 18,
                opacity: 0.6
            };

            // Social Login Mockup (Based on Image)
            if (socialType) {
                return (
                    <div className="auth-screen animate" style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        padding: '20px'
                    }}>
                        <div style={{
                            background: 'rgba(255,255,255,0.03)',
                            backdropFilter: 'blur(30px) saturate(150%)',
                            padding: '40px',
                            borderRadius: '32px',
                            border: '1px solid rgba(255,255,255,0.1)',
                            boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
                            width: '100%',
                            maxWidth: '420px',
                            textAlign: 'center'
                        }}>
                            <h2 style={{
                                color: 'white',
                                fontSize: '28px',
                                textAlign: 'center',
                                marginBottom: '24px',
                                fontWeight: '800'
                            }}>
                                Login {socialType === 'google' ? 'Google' : 'Microsoft'}
                            </h2>

                            <div style={{ marginBottom: '20px', textAlign: 'left' }}>
                                <label style={{ display: 'block', color: 'rgba(255,255,255,0.6)', marginBottom: '8px', fontSize: '13px', fontWeight: '600' }}>Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={e => setEmail(e.target.value)}
                                    style={{
                                        width: '100%',
                                        padding: '14px',
                                        background: 'rgba(255,255,255,0.05)',
                                        border: '1px solid rgba(255,255,255,0.1)',
                                        borderRadius: '12px',
                                        outline: 'none',
                                        color: 'white'
                                    }}
                                />
                            </div>

                            <div style={{ marginBottom: '24px', textAlign: 'left' }}>
                                <label style={{ display: 'block', color: 'rgba(255,255,255,0.6)', marginBottom: '8px', fontSize: '13px', fontWeight: '600' }}>Password</label>
                                <input
                                    type="password"
                                    style={{
                                        width: '100%',
                                        padding: '14px',
                                        background: 'rgba(255,255,255,0.05)',
                                        border: '1px solid rgba(255,255,255,0.1)',
                                        borderRadius: '12px',
                                        outline: 'none',
                                        color: 'white'
                                    }}
                                />
                            </div>

                            <div style={{ textAlign: 'center' }}>
                                <button
                                    onClick={() => onLogin(email.split('@')[0] || (socialType === 'google' ? 'Google User' : 'Microsoft User'))}
                                    style={{
                                        background: '#3b82f6',
                                        color: 'white',
                                        padding: '10px 24px',
                                        borderRadius: '6px',
                                        border: 'none',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        marginBottom: '12px'
                                    }}>
                                    Sign In
                                </button>
                                <div style={{ color: '#6b7280', fontSize: '14px', marginBottom: '12px' }}>Atau</div>
                                <button
                                    onClick={() => setSocialType(null)}
                                    style={{
                                        background: socialType === 'google' ? '#dc2626' : '#2563eb',
                                        color: 'white',
                                        padding: '10px 20px',
                                        borderRadius: '6px',
                                        border: 'none',
                                        fontWeight: '500',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '10px',
                                        width: '100%'
                                    }}>
                                    {socialType === 'google' ? (
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                            <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.92 3.2-1.84 4.32-1.04 1.28-2.6 2.4-5.44 2.4-4.8 0-8.68-3.88-8.68-8.68s3.88-8.68 8.68-8.68c2.6 0 4.56.92 6 2.32l2.32-2.32C21.04 1.28 17.6 0 12.4 0 5.6 0 0 5.48 0 12.4s5.6 12.4 12.4 12.4c3.6 0 6.36-1.2 8.52-3.44 2.24-2.24 2.8-5.36 2.8-7.88 0-.52-.04-1.04-.12-1.56H12.48z" />
                                        </svg>
                                    ) : (
                                        <svg width="20" height="20" viewBox="0 0 23 23">
                                            <path fill="#f3f3f3" d="M0 0h11v11H0z" /><path fill="#f3f3f3" d="M12 0h11v11H12z" /><path fill="#f3f3f3" d="M0 12h11v11H0z" /><path fill="#f3f3f3" d="M12 12h11v11H12z" /><path fill="#f25022" d="M1 1h9v9H1z" /><path fill="#7fba00" d="M13 1h9v9h-9z" /><path fill="#00a4ef" d="M1 13h9v9H1z" /><path fill="#ffb900" d="M13 13h9v9h-9z" />
                                        </svg>
                                    )}
                                    Login dengan {socialType === 'google' ? 'Google' : 'Microsoft'}
                                </button>
                                <button
                                    onClick={() => setSocialType(null)}
                                    style={{ background: 'none', border: 'none', color: '#3b82f6', marginTop: '16px', cursor: 'pointer', fontSize: '14px' }}>
                                    Kembali
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <Background3D color1="#7c3aed" color2="#ec4899">
                    <div className="auth-screen animate">
                        {/* Main Card Container */}
                        <div style={{
                            position: 'relative',
                            zIndex: 1,
                            background: 'rgba(255,255,255,0.03)',
                            backdropFilter: 'blur(30px) saturate(150%)',
                            borderRadius: 24,
                            padding: '30px',
                            border: '1px solid rgba(255,255,255,0.1)',
                            boxShadow: '0 25px 50px -12px rgba(0,0,0,0.5)',
                            maxWidth: 360,
                            width: '100%',
                            maxHeight: '90vh',
                            display: 'flex',
                            flexDirection: 'column',
                            justifyContent: 'center'
                        }}>
                            {/* Header */}
                            <div style={{ textAlign: 'center', marginBottom: 20, flexShrink: 0 }}>
                                <div style={{
                                    width: 60,
                                    height: 60,
                                    margin: '0 auto 10px',
                                    background: 'linear-gradient(145deg, #7c3aed, #4f46e5)',
                                    borderRadius: 10,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: 32,
                                    boxShadow: '0 15px 35px rgba(99, 102, 241, 0.5), inset 0 -4px 12px rgba(0,0,0,0.2), inset 0 4px 12px rgba(255,255,255,0.2)',
                                    transform: 'perspective(500px) rotateX(5deg)',
                                    border: '2px solid rgba(255,255,255,0.15)',
                                    overflow: 'hidden'
                                }}>
                                    <img src="RAMA.jpeg" alt="Logo" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                </div>
                                <h1 style={{
                                    fontSize: '28px',
                                    fontWeight: '900',
                                    color: '#FF4D4D',
                                    textShadow: '1px 1px 0 #C70039, 2px 2px 0 #900C3F, 3px 3px 0 #581845, 4px 4px 10px rgba(0,0,0,0.5)',
                                    marginBottom: 4,
                                    letterSpacing: '2px',
                                    textTransform: 'uppercase'
                                }}>{isLogin ? 'Selamat Datang!' : 'SIGN UP'}</h1>
                                <p style={{ color: 'rgba(255,255,255,0.5)', fontSize: 13 }}>
                                    {isLogin ? 'Masuk ke akun Anda' : 'Buat akun gratis sekarang'}
                                </p>
                            </div>

                            {/* Social Login */}
                            <div style={{ display: 'flex', gap: 10, marginBottom: 20 }}>
                                <button
                                    onClick={() => setSocialType('google')}
                                    style={{
                                        flex: 1,
                                        padding: '12px',
                                        background: '#dc2626',
                                        border: 'none',
                                        borderRadius: 12,
                                        color: 'white',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: 8,
                                        fontSize: 13,
                                        fontWeight: 500,
                                        fontFamily: 'inherit',
                                        transition: 'all 0.2s'
                                    }}>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="white">
                                        <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.92 3.2-1.84 4.32-1.04 1.28-2.6 2.4-5.44 2.4-4.8 0-8.68-3.88-8.68-8.68s3.88-8.68 8.68-8.68c2.6 0 4.56.92 6 2.32l2.32-2.32C21.04 1.28 17.6 0 12.4 0 5.6 0 0 5.48 0 12.4s5.6 12.4 12.4 12.4c3.6 0 6.36-1.2 8.52-3.44 2.24-2.24 2.8-5.36 2.8-7.88 0-.52-.04-1.04-.12-1.56H12.48z" />
                                    </svg>
                                    <span>Google</span>
                                </button>
                                <button
                                    onClick={() => setSocialType('microsoft')}
                                    style={{
                                        flex: 1,
                                        padding: '12px',
                                        background: '#2563eb',
                                        border: 'none',
                                        borderRadius: 12,
                                        color: 'white',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: 8,
                                        fontSize: 13,
                                        fontWeight: 500,
                                        fontFamily: 'inherit',
                                        transition: 'all 0.2s'
                                    }}>
                                    <svg width="14" height="14" viewBox="0 0 21 21" fill="white">
                                        <rect x="1" y="1" width="9" height="9" fill="white" />
                                        <rect x="11" y="1" width="9" height="9" fill="white" />
                                        <rect x="1" y="11" width="9" height="9" fill="white" />
                                        <rect x="11" y="11" width="9" height="9" fill="white" />
                                    </svg>
                                    <span>Microsoft</span>
                                </button>
                            </div>

                            {/* Divider */}
                            <div style={{ display: 'flex', alignItems: 'center', gap: 12, margin: '20px 0' }}>
                                <div style={{ flex: 1, height: 1, background: 'rgba(255,255,255,0.1)' }}></div>
                                <span style={{ color: 'rgba(255,255,255,0.4)', fontSize: 11, textTransform: 'uppercase', letterSpacing: 1 }}>atau</span>
                                <div style={{ flex: 1, height: 1, background: 'rgba(255,255,255,0.1)' }}></div>
                            </div>

                            {/* Form Fields */}
                            {!isLogin && (
                                <div style={{ position: 'relative', marginBottom: 14 }}>
                                    <span style={{ ...labelIconStyle, filter: 'drop-shadow(0 2px 3px rgba(0,0,0,0.3))' }}>
                                        <Icon name="user" size={20} />
                                    </span>
                                    <input
                                        type="text"
                                        placeholder="Nama Lengkap"
                                        value={name}
                                        onChange={e => setName(e.target.value)}
                                        style={inputStyle}
                                        onKeyDown={(e) => e.key === "Enter" && onLogin(name || email)}
                                    />
                                </div>
                            )}

                            <div style={{ position: 'relative', marginBottom: 14 }}>
                                <span style={{ ...labelIconStyle, filter: 'drop-shadow(0 2px 3px rgba(0,0,0,0.3))' }}>
                                    <Icon name="mail" size={20} />
                                </span>
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value={email}
                                    onChange={e => setEmail(e.target.value)}
                                    style={inputStyle}
                                    onKeyDown={(e) => e.key === "Enter" && onLogin(name || email)}
                                />
                            </div>

                            <div style={{ position: 'relative', marginBottom: 8 }}>
                                <span style={{ ...labelIconStyle, filter: 'drop-shadow(0 2px 3px rgba(0,0,0,0.3))' }}>
                                    <Icon name="lock" size={20} />
                                </span>
                                <input
                                    type="password"
                                    placeholder="Password"
                                    style={inputStyle}
                                    onKeyDown={(e) => e.key === "Enter" && onLogin(name || email)}
                                />
                            </div>

                            {isLogin && (
                                <p style={{ textAlign: 'right', marginBottom: 16 }}>
                                    <span style={{ color: '#6366f1', fontSize: 12, cursor: 'pointer' }}>Lupa Password?</span>
                                </p>
                            )}

                            {!isLogin && (
                                <label style={{ display: 'flex', alignItems: 'center', gap: 10, marginTop: 12, marginBottom: 16, cursor: 'pointer' }}>
                                    <input type="checkbox" style={{ width: 18, height: 18, accentColor: '#6366f1', borderRadius: 4 }} />
                                    <span style={{ fontSize: 12, color: 'rgba(255,255,255,0.5)', lineHeight: 1.4 }}>
                                        Saya setuju dengan <span style={{ color: '#6366f1' }}>Ketentuan Layanan</span>
                                    </span>
                                </label>
                            )}

                            <button
                                onClick={() => onLogin(name || email.split('@')[0])}
                                style={{
                                    width: '100%',
                                    padding: '16px',
                                    background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',
                                    border: 'none',
                                    borderRadius: 14,
                                    color: 'white',
                                    fontSize: 15,
                                    fontWeight: 600,
                                    cursor: 'pointer',
                                    boxShadow: '0 8px 24px rgba(99, 102, 241, 0.35)',
                                    transition: 'all 0.3s ease',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    gap: 8
                                }}
                            >
                                {isLogin ? 'Masuk' : 'Daftar Sekarang'} <Icon name="arrow-right" size={18} />
                            </button>

                            <p style={{ textAlign: 'center', marginTop: 20, fontSize: 13, color: 'rgba(255,255,255,0.5)' }}>
                                {isLogin ? 'Belum punya akun? ' : 'Sudah punya akun? '}
                                <span
                                    onClick={() => setIsLogin(!isLogin)}
                                    style={{ color: '#6366f1', cursor: 'pointer', fontWeight: 600 }}
                                >
                                    {isLogin ? 'Daftar' : 'Masuk'}
                                </span>
                            </p>
                        </div>
                    </div>
                </Background3D>
            );
        };

        // --- 3D Background Wrapper ---
        const Background3D = ({ children, color1, color2, showGrid = true }) => {
            return (
                <div className="page-container-3d">
                    <div className="bg-blob blob-1" style={{ background: color1 || 'var(--primary)' }}></div>
                    <div className="bg-blob blob-2" style={{ background: color2 || 'var(--secondary)' }}></div>
                    {showGrid && <div className="mesh-grid"></div>}
                    <div className="glass-panel-3d">
                        {children}
                    </div>
                </div>
            );
        };

        // --- Bidang (Categories) Screen ---
        const Bidang = ({ onBidangClick, getCategoryCount }) => {
            const categories = [
                { name: 'Hardware', icon: 'ðŸ–¥ï¸', color: '#3B82F6' },
                { name: 'Software', icon: 'ðŸ’¿', color: '#8B5CF6' },
                { name: 'Network', icon: 'ðŸŒ', color: '#10B981' },
                { name: 'Security', icon: 'ðŸ›¡ï¸', color: '#EF4444' },
                { name: 'Database', icon: 'ðŸ—„ï¸', color: '#F59E0B' },
                { name: 'Development', icon: 'âš¡', color: '#EC4899' },
                { name: 'Runtimes', icon: 'ðŸš€', color: '#F59E0B' },
                { name: 'Cloud', icon: 'â˜ï¸', color: '#0EA5E9' }
            ];

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate">
                        <header className="page-header" style={{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))' }}>
                            <h1 style={{ fontSize: '24px', fontWeight: '800', color: 'white' }}>Bidang IT</h1>
                            <div className="search-bar" style={{ background: 'rgba(255,255,255,0.2)', border: 'none', marginTop: 16 }}>
                                <Icon name="search" color="white" />
                                <input type="text" placeholder="Cari bidang keahlianmu..." style={{ color: 'white' }} />
                            </div>
                        </header>
                        <div className="container" style={{ padding: '24px 0' }}>
                            <div className="grid-responsive">
                                {categories.map(cat => (
                                    <div key={cat.name} className="card bidang-card" onClick={() => onBidangClick && onBidangClick(cat)} style={{
                                        '--glow-color': cat.color,
                                        position: 'relative'
                                    }}>
                                        <div className="category-glow-bg"></div>
                                        <div className="icon-container-3d">
                                            <div className="icon-box" style={{ fontSize: 'clamp(32px, 6vw, 44px)' }}>
                                                {cat.icon}
                                            </div>
                                            <div className="icon-shadow-3d"></div>
                                        </div>
                                        <div style={{
                                            fontSize: '14px',
                                            fontWeight: '800',
                                            color: 'white',
                                            marginBottom: 4,
                                            zIndex: 10
                                        }}>{cat.name}</div>
                                        <div style={{
                                            fontSize: '11px',
                                            color: cat.color,
                                            fontWeight: 700,
                                            textTransform: 'uppercase',
                                            letterSpacing: 1,
                                            zIndex: 10
                                        }}>{getCategoryCount ? getCategoryCount(cat.name) : 0} TOPIK</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </Background3D>
            );
        };

        const Pesan = ({ userName, onNavigate }) => {
            const [filter, setFilter] = useState('inbox');
            const chats = [
                { name: 'Natasya Rina', msg: 'Bisa kita diskusi lebih lanjut?', time: '2m', unread: true, image: 'https://i.pravatar.cc/150?u=12' },
                { name: 'Budi Santoso', msg: 'Terima kasih atas solusinya!', time: '1h', unread: false, image: 'https://i.pravatar.cc/150?u=1' },
                { name: 'Ahmad Rizky', msg: 'Update hardware sudah selesai.', time: '3h', unread: false, image: 'https://i.pravatar.cc/150?u=3' }
            ];

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate sidebar-page-container">
                        <div className="app-sidebar">
                            <div className="sidebar-header">
                                <h2>Riwayat Diskusi</h2>
                                <p>Chat & Konsultasi</p>
                            </div>
                            <div className="sidebar-menu">
                                <button className={filter === 'inbox' ? 'active' : ''} onClick={() => setFilter('inbox')}><Icon name="message-circle" size={18} /> Kotak Masuk</button>
                                <button className={filter === 'archived' ? 'active' : ''} onClick={() => setFilter('archived')}><Icon name="archive" size={18} /> Arsip</button>
                                <button className={filter === 'contacts' ? 'active' : ''} onClick={() => setFilter('contacts')}><Icon name="users" size={18} /> Kontak</button>
                            </div>
                        </div>
                        <div className="app-content">
                            <header className="mobile-header" style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                <div onClick={() => onNavigate && onNavigate('home')} style={{ cursor: 'pointer', padding: 8, background: 'rgba(99, 102, 241, 0.15)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <Icon name="chevron-left" size={20} color="var(--primary)" />
                                </div>
                                <h1>Riwayat Diskusi</h1>
                            </header>

                            <div className="search-bar" style={{ background: 'rgba(255,255,255,0.05)', border: '1px solid var(--border)', marginBottom: 24 }}>
                                <Icon name="search" color="var(--text-gray)" />
                                <input type="text" placeholder="Cari pesan atau teman..." style={{ color: 'white' }} />
                            </div>

                            {filter === 'inbox' && (
                                <div style={{ display: 'flex', flexDirection: 'column', gap: 10 }}>
                                    {chats.map((c, i) => (
                                        <div key={i} className="card" style={{ display: 'flex', alignItems: 'center', gap: 16, margin: 0, cursor: 'pointer' }}>
                                            <div style={{ position: 'relative' }}>
                                                <img src={c.image} style={{ width: 50, height: 50, borderRadius: '50%', objectFit: 'cover' }} />
                                                {c.unread && <div style={{ position: 'absolute', top: 0, right: 0, width: 12, height: 12, background: '#EF4444', borderRadius: '50%', border: '2px solid var(--bg-card)' }}></div>}
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                                                    <div style={{ fontWeight: 700, fontSize: 15 }}>{c.name}</div>
                                                    <div style={{ fontSize: 11, color: 'var(--text-gray)' }}>{c.time}</div>
                                                </div>
                                                <div style={{ fontSize: 13, color: c.unread ? 'white' : 'var(--text-gray)', fontWeight: c.unread ? 600 : 400 }}>{c.msg}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            {filter !== 'inbox' && <div style={{ padding: 40, textAlign: 'center', color: 'var(--text-gray)' }}>Folder ini kosong</div>}
                        </div>
                    </div>
                </Background3D>
            );
        };

        const Notifikasi = ({ onNavigate, notifications = [], onNotificationClick }) => {
            const [filter, setFilter] = useState('all');

            // Filter logic
            const filtered = filter === 'all' ? notifications : notifications.filter(n => n.type === filter);

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate sidebar-page-container">
                        <div className="app-sidebar">
                            <div className="sidebar-header">
                                <h2>Notifikasi</h2>
                            </div>
                            <div className="sidebar-menu">
                                <button className={filter === 'all' ? 'active' : ''} onClick={() => setFilter('all')}><Icon name="inbox" size={18} /> Semua</button>
                                <button className={filter === 'message' ? 'active' : ''} onClick={() => setFilter('message')}><Icon name="message-circle" size={18} /> Pesan & Diskusi</button>
                                <button className={filter === 'award' ? 'active' : ''} onClick={() => setFilter('award')}><Icon name="award" size={18} /> Pencapaian</button>
                                <button className={filter === 'info' ? 'active' : ''} onClick={() => setFilter('info')}><Icon name="info" size={18} /> Sistem</button>
                            </div>
                        </div>
                        <div className="app-content">
                            <header className="mobile-header" style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                <div onClick={() => onNavigate && onNavigate('home')} style={{ cursor: 'pointer', padding: 8, background: 'rgba(99, 102, 241, 0.15)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <Icon name="chevron-left" size={20} color="var(--primary)" />
                                </div>
                                <h1>Notifikasi</h1>
                            </header>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                                {filtered.length === 0 && <div style={{ color: 'var(--text-gray)', textAlign: 'center', marginTop: 40 }}>Tidak ada notifikasi di kategori ini.</div>}
                                {filtered.map(n => (
                                    <div key={n.id} className="card"
                                        onClick={() => onNotificationClick && onNotificationClick(n)}
                                        style={{ display: 'flex', gap: 16, alignItems: 'center', margin: 0, cursor: 'pointer', borderLeft: n.unread ? '3px solid var(--primary)' : 'none' }}>
                                        <div style={{ width: 44, height: 44, borderRadius: 12, background: 'rgba(255,255,255,0.05)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--primary)', flexShrink: 0 }}>
                                            <Icon name={n.type === 'message' ? 'message-square' : n.type === 'award' ? 'award' : 'bell'} />
                                        </div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: 700, fontSize: 14 }}>{n.title}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text-gray)', marginTop: 2 }}>{n.desc}</div>
                                            <div style={{ fontSize: 10, color: 'rgba(255,255,255,0.2)', marginTop: 4 }}>{n.time}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </Background3D>
            );
        };

        const Bantuan = ({ onNavigate }) => {
            const [tab, setTab] = useState('umum');
            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate sidebar-page-container">
                        <div className="app-sidebar">
                            <div className="sidebar-header">
                                <h2>Pusat Bantuan</h2>
                                <p>Support Center</p>
                            </div>
                            <div className="sidebar-menu">
                                <button className={tab === 'umum' ? 'active' : ''} onClick={() => setTab('umum')}><Icon name="info" size={18} /> Umum</button>
                                <button className={tab === 'faq' ? 'active' : ''} onClick={() => setTab('faq')}><Icon name="help-circle" size={18} /> FAQ</button>
                                <button className={tab === 'contact' ? 'active' : ''} onClick={() => setTab('contact')}><Icon name="mail" size={18} /> Hubungi Kami</button>
                            </div>
                        </div>

                        <div className="app-content">
                            <header className="mobile-header" style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                <div onClick={() => onNavigate && onNavigate('home')} style={{ cursor: 'pointer', padding: 8, background: 'rgba(99, 102, 241, 0.15)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <Icon name="chevron-left" size={20} color="var(--primary)" />
                                </div>
                                <h1>Bantuan</h1>
                            </header>
                            {tab === 'umum' && (
                                <div className="card" style={{ padding: 24, textAlign: 'center' }}>
                                    <div style={{ width: 80, height: 80, background: 'linear-gradient(135deg, var(--primary), var(--secondary))', borderRadius: 20, margin: '0 auto 20px', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 10px 30px rgba(99, 102, 241, 0.3)' }}>
                                        <Icon name="info" size={40} color="white" />
                                    </div>
                                    <h2 style={{ fontSize: 20, fontWeight: 800, marginBottom: 8 }}>Belajar Bersama v2.0</h2>
                                    <p style={{ fontSize: 13, color: 'var(--text-gray)', lineHeight: 1.6 }}>Platform kolaborasi IT Support & Troubleshooting antar karyawan.</p>

                                    <div className="card" style={{ marginTop: 24, background: 'rgba(255,255,255,0.03)', textAlign: 'left' }}>
                                        <h4 style={{ fontSize: 14, fontWeight: 700, marginBottom: 16 }}>Keamanan & Privasi</h4>
                                        <div style={{ fontSize: 12, color: 'var(--text-gray)', display: 'flex', flexDirection: 'column', gap: 12 }}>
                                            <p style={{ lineHeight: 1.5 }}>Data Anda terlindungi dengan enkripsi standar industri.</p>
                                            <div style={{ height: 1, background: 'rgba(255,255,255,0.05)', margin: '4px 0' }} />
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}><span>Versi</span><span style={{ color: 'white' }}>2.0.1</span></div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}><span>Developer</span><span style={{ color: 'white' }}>Muhammad Ramadhan</span></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {tab === 'faq' && (
                                <div>
                                    <div className="card"><h4 style={{ marginBottom: 8 }}>Bagaimana cara reset password?</h4><p style={{ fontSize: 13, color: 'var(--text-gray)' }}>Hubungi admin IT melalui menu Kontak atau gunakan fitur Lupa Password di halaman login.</p></div>
                                    <div className="card"><h4 style={{ marginBottom: 8 }}>Apakah chat bersifat pribadi?</h4><p style={{ fontSize: 13, color: 'var(--text-gray)' }}>Ya, chat antar pengguna dienkripsi. Namun diskusi publik dapat dilihat oleh semua anggota.</p></div>
                                </div>
                            )}
                            {tab === 'contact' && (
                                <div className="card" style={{ textAlign: 'center', padding: '40px 20px' }}>
                                    <Icon name="mail" size={48} color="var(--primary)" />
                                    <h3>Butuh Bantuan Lebih?</h3>
                                    <button style={{ marginTop: 16, padding: '12px 24px', background: 'var(--primary)', color: 'white', border: 'none', borderRadius: 8 }}>Email IT Support</button>
                                </div>
                            )}
                        </div>
                    </div>
                </Background3D>
            );
        };

        const KnowledgeFeed = ({ onBack, knowledgeBase, searchTerm, onKnowledgeClick }) => {
            const [selectedId, setSelectedId] = useState(null);
            const [isAnalyzingLocal, setIsAnalyzingLocal] = useState(false);

            const displayKnowledge = knowledgeBase.filter(k =>
                !searchTerm ||
                k.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                k.question.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const selectedItem = knowledgeBase.find(k => k.id === selectedId);

            const handleItemClick = (k) => {
                if (onKnowledgeClick) {
                    onKnowledgeClick(k);
                } else {
                    setSelectedId(k.id);
                    setIsAnalyzingLocal(true);
                    setTimeout(() => setIsAnalyzingLocal(false), 2000);
                }
            };

            return (
                <div className="animate">
                    {onBack && (
                        <header className="page-header" style={{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 8 }}>
                                <div onClick={onBack} style={{ cursor: 'pointer', background: 'rgba(255,255,255,0.2)', padding: 8, borderRadius: 10, display: 'flex' }}>
                                    <Icon name="chevron-left" size={20} color="white" />
                                </div>
                                <h1 style={{ fontSize: '20px', fontWeight: '800', color: 'white' }}>Semua Pengetahuan</h1>
                            </div>
                            <p style={{ color: 'rgba(255,255,255,0.8)', fontSize: '12px', marginLeft: 44 }}>Daftar lengkap analisa AI & Google Update</p>
                        </header>
                    )}

                    <div className="container" style={{ padding: '24px 0' }}>
                        <div className="grid-responsive">
                            {displayKnowledge.map((k, i) => (
                                <div key={i} className="card"
                                    onClick={() => handleItemClick(k)}
                                    style={{ display: 'flex', gap: 16, alignItems: 'center', margin: 0 }}>
                                    <div style={{ width: 44, height: 44, borderRadius: 12, background: `${k.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: k.color, flexShrink: 0 }}>
                                        <Icon name={k.icon} size={22} />
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 6, marginBottom: 4 }}>
                                            <div style={{ fontSize: 9, padding: '2px 8px', background: 'rgba(239, 68, 68, 0.1)', color: '#EF4444', borderRadius: 20, fontWeight: 700 }}>
                                                TRENDING
                                            </div>
                                            <div style={{ fontSize: 9, color: 'var(--text-gray)' }}>{k.trendInfo}</div>
                                        </div>
                                        <div style={{ fontWeight: 700, fontSize: 13, color: 'white' }}>{k.title}</div>
                                        <div style={{ fontSize: 10, color: 'var(--text-gray)', marginTop: 2 }}>{k.desc}</div>
                                    </div>
                                    <Icon name="chevron-right" size={14} color="rgba(255,255,255,0.1)" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {selectedItem && (
                        <div style={{
                            position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
                            background: 'rgba(0,0,0,0.9)', backdropFilter: 'blur(15px)',
                            zIndex: 30000, display: 'flex', alignItems: 'center', justifyContent: 'center',
                            padding: 20
                        }} onClick={() => setSelectedId(null)}>
                            <div className="animate" style={{
                                maxWidth: 650, width: '100%', background: 'var(--bg-card)',
                                borderRadius: 32, border: '1px solid var(--primary)',
                                maxHeight: '90vh', overflowY: 'auto', padding: 0,
                                position: 'relative', boxShadow: '0 0 80px rgba(99, 102, 241, 0.4)',
                                overflow: 'hidden'
                            }} onClick={e => e.stopPropagation()}>
                                {isAnalyzingLocal && (
                                    <div style={{
                                        position: 'absolute', top: 0, left: 0, right: 0, bottom: 0,
                                        background: 'rgba(15, 23, 42, 0.95)', zIndex: 40000,
                                        display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
                                        gap: 20
                                    }}>
                                        <div className="animate-pulse" style={{ width: 80, height: 80, borderRadius: '50%', border: '4px solid var(--primary)', borderTopColor: 'transparent', animation: 'spin 1s linear infinite' }}></div>
                                        <div style={{ color: 'white', fontWeight: 800, fontSize: 18 }}>AI Sedang Menganalisa...</div>
                                        <div style={{ color: 'var(--text-gray)', fontSize: 12 }}>Menghubungkan ke Google Search & Database Internal</div>
                                    </div>
                                )}
                                <div style={{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))', padding: '24px 30px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 15 }}>
                                        <div style={{ width: 44, height: 44, background: 'rgba(255,255,255,0.2)', borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                            <Icon name="brain-circuit" size={24} color="white" />
                                        </div>
                                        <div>
                                            <div style={{ fontSize: 18, fontWeight: 900, color: 'white' }}>Laporan Analisa Deep-AI</div>
                                            <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.7)', fontWeight: 600 }}>Sinkronisasi Google Data + AI Real-time</div>
                                        </div>
                                    </div>
                                    <div onClick={() => setSelectedId(null)} style={{ cursor: 'pointer', background: 'rgba(0,0,0,0.2)', padding: 10, borderRadius: '50%', color: 'white' }}><Icon name="x" size={20} /></div>
                                </div>

                                <div style={{ padding: 30 }}>
                                    {/* Question Section */}
                                    <div style={{ marginBottom: 24 }}>
                                        <div style={{ fontSize: 11, fontWeight: 800, color: 'var(--primary)', marginBottom: 10, textTransform: 'uppercase', letterSpacing: 1.5 }}>Ringkasan Masalah</div>
                                        <div style={{ fontSize: 16, fontWeight: 700, color: 'white', lineHeight: 1.5, background: 'rgba(99, 102, 241, 0.05)', padding: 16, borderRadius: 16, borderLeft: '4px solid var(--primary)' }}>
                                            "{selectedItem.question}"
                                        </div>
                                    </div>

                                    {/* AI Crawling Section */}
                                    <div style={{ marginBottom: 24, display: 'grid', gridTemplateColumns: 'minmax(0, 1fr) minmax(0, 1fr)', gap: 16 }}>
                                        <div className="card" style={{ background: 'rgba(16, 185, 129, 0.05)', padding: 16, borderRadius: 20, border: '1px solid rgba(16, 185, 129, 0.1)', margin: 0 }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#10B981', marginBottom: 10 }}>
                                                <Icon name="activity" size={16} />
                                                <div style={{ fontSize: 11, fontWeight: 800 }}>AI CRAWLING ENGINE</div>
                                            </div>
                                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, marginBottom: 12 }}>{selectedItem.aiCrawling}</div>
                                            <button
                                                onClick={() => alert('Sumber AI: Verified Support Thread & Knowledge Base #8812')}
                                                style={{ background: 'rgba(16, 185, 129, 0.1)', border: 'none', borderRadius: 8, color: '#10B981', fontSize: 10, fontWeight: 700, padding: '6px 10px', cursor: 'pointer' }}>
                                                Tinjau Resource AI
                                            </button>
                                        </div>
                                        <div className="card" style={{ background: 'rgba(66, 133, 244, 0.05)', padding: 16, borderRadius: 20, border: '1px solid rgba(66, 133, 244, 0.1)', margin: 0 }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#4285F4', marginBottom: 10 }}>
                                                <Icon name="search" size={16} />
                                                <div style={{ fontSize: 11, fontWeight: 800 }}>GOOGLE SEARCH INSIGHT</div>
                                            </div>
                                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, whiteSpace: 'pre-line', marginBottom: 12 }}>{selectedItem.googleInsight}</div>
                                            <button
                                                onClick={() => window.open(`https://www.google.com/search?q=${encodeURIComponent(selectedItem.title)}`, '_blank')}
                                                style={{ background: 'rgba(66, 133, 244, 0.1)', border: 'none', borderRadius: 8, color: '#4285F4', fontSize: 10, fontWeight: 700, padding: '6px 10px', cursor: 'pointer' }}>
                                                Lihat di Google
                                            </button>
                                        </div>
                                    </div>

                                    {/* Detailed Analysis Section */}
                                    <div style={{ background: 'rgba(255,255,255,0.03)', padding: 24, borderRadius: 24, border: '1px solid var(--border)' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 16 }}>
                                            <Icon name="clipboard-check" color="var(--primary)" size={18} />
                                            <div style={{ fontSize: 13, fontWeight: 800, color: 'white' }}>SOLUSI & LANGKAH PERBAIKAN</div>
                                        </div>
                                        <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.8)', lineHeight: 1.8, whiteSpace: 'pre-line' }}>
                                            {selectedItem.analysis}
                                        </div>
                                    </div>

                                    <div style={{ display: 'flex', gap: 12, marginTop: 30 }}>
                                        <button
                                            onClick={() => {
                                                navigator.clipboard.writeText(selectedItem.analysis);
                                                alert('Solusi berhasil disalin ke clipboard!');
                                            }}
                                            style={{
                                                flex: 1, padding: '16px',
                                                background: 'rgba(255,255,255,0.05)',
                                                border: '1px solid var(--border)', borderRadius: 16, color: 'white',
                                                fontWeight: 800, fontSize: 14, cursor: 'pointer',
                                                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8
                                            }}>
                                            <Icon name="copy" size={18} /> Salin Solusi
                                        </button>
                                        <button
                                            onClick={() => globalShare({ title: selectedItem.title, text: selectedItem.analysis })}
                                            style={{
                                                flex: 1, padding: '16px',
                                                background: 'linear-gradient(135deg, var(--primary), var(--secondary))',
                                                border: 'none', borderRadius: 16, color: 'white',
                                                fontWeight: 800, fontSize: 14, cursor: 'pointer',
                                                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                                                boxShadow: '0 10px 25px rgba(99, 102, 241, 0.3)'
                                            }}>
                                            <Icon name="share-2" size={18} /> Bagikan
                                        </button>
                                    </div>
                                    <button
                                        onClick={() => setSelectedId(null)}
                                        style={{ width: '100%', padding: '12px', background: 'transparent', border: 'none', color: 'var(--text-gray)', fontSize: 13, fontWeight: 600, marginTop: 16, cursor: 'pointer' }}>
                                        Tutup Laporan
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Profil = ({ userName, userRole, isPrivate, onTogglePrivate, onLogout, onNavigate }) => {
            const [tab, setTab] = useState('ringkasan');

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">


                    <div className="animate sidebar-page-container">
                        {/* Sidebar (Slide Bar) */}
                        <div className="app-sidebar">
                            <div className="sidebar-header">
                                <h2>Profil Saya</h2>
                                <p>Kelola akun & preferensi</p>
                            </div>
                            <div className="sidebar-menu">
                                <button className={tab === 'ringkasan' ? 'active' : ''} onClick={() => setTab('ringkasan')}>
                                    <Icon name="user" size={18} /> Ringkasan
                                </button>
                                <button className={tab === 'security' ? 'active' : ''} onClick={() => setTab('security')}>
                                    <Icon name="shield" size={18} /> Keamanan
                                </button>
                                <button className={tab === 'settings' ? 'active' : ''} onClick={() => setTab('settings')}>
                                    <Icon name="settings" size={18} /> Pengaturan
                                </button>
                            </div>
                        </div>

                        {/* Content Area */}
                        <div className="app-content">
                            <header className="mobile-header" style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                <div onClick={() => onNavigate && onNavigate('home')} style={{ cursor: 'pointer', padding: 8, background: 'rgba(99, 102, 241, 0.15)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <Icon name="chevron-left" size={20} color="var(--primary)" />
                                </div>
                                <h1 style={{ fontSize: 24 }}>Profil Saya</h1>
                            </header>

                            {tab === 'ringkasan' && (
                                <div className="animate">
                                    <div className="card" style={{ display: 'flex', alignItems: 'center', gap: 20, padding: 30, background: 'linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0))', border: '1px solid var(--primary)' }}>
                                        <div style={{ position: 'relative', width: 80, height: 80 }}>
                                            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200" style={{ width: '100%', height: '100%', borderRadius: '50%', objectFit: 'cover', border: '2px solid white' }} />
                                            <div style={{ position: 'absolute', bottom: 0, right: 0, width: 24, height: 24, background: '#10B981', borderRadius: '50%', border: '2px solid #1e1e1e' }}></div>
                                        </div>
                                        <div>
                                            <h2 style={{ fontSize: 24, marginBottom: 4 }}>{userName || 'Karyawan'}</h2>
                                            <div style={{ color: 'var(--text-gray)', fontSize: 13, marginBottom: 12 }}>{userRole} â€¢ Senior System Admin</div>
                                            <div style={{ display: 'flex', gap: 8 }}>
                                                <span className="tag" style={{ background: 'rgba(99, 102, 241, 0.2)', color: '#818cf8', border: 'none' }}>Level 12</span>
                                                <span className="tag" style={{ background: 'rgba(16, 185, 129, 0.2)', color: '#34d399', border: 'none' }}>Verified</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="card" style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', textAlign: 'center', padding: '24px 0', marginTop: 24 }}>
                                        <div>
                                            <div style={{ fontSize: 20, fontWeight: 800 }}>128</div>
                                            <div style={{ fontSize: 11, color: 'var(--text-gray)', textTransform: 'uppercase', marginTop: 4 }}>Diskusi</div>
                                        </div>
                                        <div style={{ borderLeft: '1px solid var(--border)', borderRight: '1px solid var(--border)' }}>
                                            <div style={{ fontSize: 20, fontWeight: 800 }}>85%</div>
                                            <div style={{ fontSize: 11, color: 'var(--text-gray)', textTransform: 'uppercase', marginTop: 4 }}>Solusi</div>
                                        </div>
                                        <div>
                                            <div style={{ fontSize: 20, fontWeight: 800 }}>1.2k</div>
                                            <div style={{ fontSize: 11, color: 'var(--text-gray)', textTransform: 'uppercase', marginTop: 4 }}>Poin</div>
                                        </div>
                                    </div>

                                    <div className="card" style={{ marginTop: 24 }}>
                                        <h3 style={{ fontSize: 16, marginBottom: 16 }}>Keahlian IT</h3>
                                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>
                                            {['Hardware', 'Networking', 'Software Install', 'Windows OS'].map(t => (
                                                <span key={t} className="tag">{t}</span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {tab === 'security' && (
                                <div className="animate">
                                    <div className="card" style={{ marginBottom: 16 }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                                <Icon name="shield" color="#10B981" />
                                                <div style={{ fontWeight: 700 }}>Privasi Akun</div>
                                            </div>
                                            <div
                                                onClick={onTogglePrivate}
                                                style={{
                                                    width: 44, height: 24, borderRadius: 12,
                                                    background: isPrivate ? 'var(--primary)' : 'rgba(255,255,255,0.1)',
                                                    position: 'relative', transition: '0.3s', cursor: 'pointer'
                                                }}
                                            >
                                                <div style={{
                                                    width: 18, height: 18, borderRadius: '50%', background: 'white',
                                                    position: 'absolute', top: 3, left: isPrivate ? 23 : 3, transition: '0.3s'
                                                }}></div>
                                            </div>
                                        </div>
                                        <p style={{ fontSize: 12, color: 'var(--text-gray)', lineHeight: 1.5 }}>Mode privat menyamarkan nama Anda pada daftar anggota publik.</p>
                                    </div>
                                    <div className="card">
                                        <h4 style={{ marginBottom: 12 }}>Ganti Password</h4>
                                        <input type="password" placeholder="Password Lama" style={{ width: '100%', padding: 12, background: 'var(--bg)', border: '1px solid var(--border)', borderRadius: 8, marginBottom: 10, color: 'white' }} />
                                        <input type="password" placeholder="Password Baru" style={{ width: '100%', padding: 12, background: 'var(--bg)', border: '1px solid var(--border)', borderRadius: 8, color: 'white' }} />
                                        <button style={{ marginTop: 12, padding: '10px 20px', background: 'var(--primary)', color: 'white', border: 'none', borderRadius: 8 }}>Simpan</button>
                                    </div>
                                </div>
                            )}

                            {tab === 'settings' && (
                                <div className="animate">
                                    <div className="card">
                                        <h4>Konfigurasi Aplikasi</h4>
                                        <div style={{ marginTop: 10, fontSize: 13, color: 'var(--text-gray)' }}>Versi 2.0.1</div>
                                    </div>
                                    <button
                                        onClick={onLogout}
                                        className="card"
                                        style={{ width: '100%', display: 'flex', alignItems: 'center', gap: 16, border: 'none', background: 'rgba(239, 68, 68, 0.1)', color: '#EF4444', fontWeight: 600, cursor: 'pointer', marginTop: 16 }}
                                    >
                                        <Icon name="log-out" color="#EF4444" />
                                        <div style={{ flex: 1, textAlign: 'left' }}>Keluar Sesi</div>
                                    </button>
                                </div>
                            )}

                        </div>
                    </div>
                </Background3D>
            );
        };

        // --- Bidang Detail Screen (The "New Bar" View) ---
        const BidangDetail = ({ bidang, onBack, currentUserName, onAddKnowledge, categoryData, onUpdateCategoryData, addNotification }) => {
            const [activeTab, setActiveTab] = useState('diskusi');
            const [msg, setMsg] = useState('');
            const [showMemberSelector, setShowMemberSelector] = useState(false);
            const inputRef = React.useRef(null);

            // State for Expert Tab
            const [expertPostText, setExpertPostText] = useState('');
            const [commentInputs, setCommentInputs] = useState({}); // Mapping postId -> text
            const [visibleComments, setVisibleComments] = useState({}); // Mapping postId -> boolean

            const { discussions, chatMessages } = categoryData;

            const handleSend = () => {
                if (!msg.trim()) return;
                const now = new Date();
                const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

                if (activeTab === 'diskusi' && !msg.startsWith('@')) {
                    const newDisq = { user: currentUserName || "Anda", title: msg, tags: [bidang.name, "Baru"], comments: 0 };

                    onUpdateCategoryData(bidang.name, {
                        discussions: [newDisq, ...discussions],
                        chatMessages: chatMessages
                    });

                    // Automated AI Evaluation for specific Hardware problems
                    if (msg.toLowerCase().includes('blank') || msg.toLowerCase().includes('pos')) {
                        if (onAddKnowledge) {
                            onAddKnowledge({
                                id: 'pos-blank-' + Date.now(), icon: 'monitor', color: '#EF4444',
                                title: "Evaluasi: POS Enterprise Blank Layar PC",
                                trendInfo: "Trending di Bidang Hardware",
                                desc: "Evaluasi Otomatis AI: Deteksi kegagalan sinkronisasi driver GPU POS.V4",
                                analysis: "Hasil Evaluasi Gabungan (Google Support & AI): \n\n**Akar Masalah:** \nDriver grafis terintegrasi PC mengalami instruksi 'null pointer' saat memuat UI POS Enterprise. \n\n**Langkah Pemecahan:** \n1. Bersihkan Temporary Files di `%temp%`. \n2. ReinstalasI Driver Intel UHD/AMD Radeon ke versi WHQL. \n3. Ubah setting 'Full Screen' ke 'Windowed-Borderless' di config POS."
                            });
                        }
                    }

                    alert('Pertanyaan baru telah ditambahkan & Evaluasi AI Dimulai!');
                } else {
                    const newMsg = { user: currentUserName || "Anda", text: msg, time: timeStr };

                    onUpdateCategoryData(bidang.name, {
                        discussions: discussions,
                        chatMessages: [...chatMessages, newMsg]
                    });

                    if (activeTab === 'diskusi') setActiveTab('ahli');
                }
                setMsg('');
            };

            const handleReplyTo = (user) => {
                setMsg(`@${user} `);
                setTimeout(() => inputRef.current?.focus(), 100);
            };

            const selectMember = (member) => {
                alert(`Rekan "${member.name}" berhasil dihubungkan ke diskusi ini.`);
                setShowMemberSelector(false);
            };

            const ChatMessage = ({ user, text, time }) => (
                <div style={{ display: 'flex', gap: 12, marginBottom: 16 }}>
                    <div style={{ width: 32, height: 32, borderRadius: '50%', background: 'rgba(255,255,255,0.1)', flexShrink: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 12 }}>{user[0]}</div>
                    <div style={{ background: 'var(--bg-card)', padding: '10px 14px', borderRadius: '0 12px 12px 12px', border: '1px solid var(--border)', flex: 1 }}>
                        <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--primary)', marginBottom: 2 }}>{user}</div>
                        <div style={{ fontSize: 13, color: 'white' }}>{text}</div>
                        <div style={{ fontSize: 9, color: 'var(--text-gray)', marginTop: 4, textAlign: 'right' }}>{time}</div>
                    </div>
                </div>
            );

            return (
                <Background3D color1={bidang.color || 'var(--primary)'} color2="var(--secondary)">
                    <div className="animate" style={{ position: 'relative' }}>
                        {/* Member Selection Overlay */}
                        {showMemberSelector && (
                            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.8)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
                                <div className="card animate" style={{ width: '100%', maxWidth: 360, maxHeight: '70vh', overflow: 'auto', border: '1px solid var(--primary)' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
                                        <h3 style={{ fontSize: 18 }}>Pilih Rekan Kerja</h3>
                                        <div onClick={() => setShowMemberSelector(false)} style={{ cursor: 'pointer', padding: 8 }}><Icon name="x" /></div>
                                    </div>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                                        {REGISTERED_MEMBERS.map(m => (
                                            <div key={m.id} onClick={() => selectMember(m)} className="nav-item" style={{ padding: 12, borderRadius: 12, background: 'rgba(255,255,255,0.03)', border: '1px solid var(--border)', display: 'flex', gap: 12, alignItems: 'center', cursor: 'pointer' }}>
                                                <img src={m.image} style={{ width: 40, height: 40, borderRadius: '50%', objectFit: 'cover' }} />
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ fontWeight: 600, fontSize: 14 }}>{m.name}</div>
                                                    <div style={{ fontSize: 11, color: 'var(--text-gray)' }}>{m.role}</div>
                                                </div>
                                                <Icon name="plus" size={16} color="var(--primary)" />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Header with Back Button */}
                        <header className="page-header" style={{
                            background: `linear-gradient(135deg, ${bidang.color || 'var(--primary)'}, ${bidang.color || 'var(--secondary)'}dd)`,
                            color: 'white',
                            boxShadow: `0 10px 30px ${(bidang.color || 'var(--primary)')}44`
                        }}>
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 20 }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                                    <div onClick={onBack} style={{ cursor: 'pointer', padding: 8, background: 'rgba(255,255,255,0.2)', borderRadius: '50%' }}>
                                        <Icon name="chevron-left" size={24} color="white" />
                                    </div>
                                    <h2 style={{ fontSize: 20, fontWeight: 800 }}>{bidang.name}</h2>
                                </div>
                                <button onClick={() => setShowMemberSelector(true)} style={{
                                    padding: '8px 14px',
                                    background: 'rgba(0,0,0,0.2)',
                                    border: '1px solid rgba(255,255,255,0.1)',
                                    borderRadius: 12,
                                    color: 'white',
                                    fontSize: 12,
                                    fontWeight: 700,
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: 6,
                                    cursor: 'pointer'
                                }}>
                                    <Icon name="user-plus" size={16} /> Undangan
                                </button>
                            </div>

                            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
                                <div style={{
                                    width: 50, height: 50,
                                    borderRadius: 14,
                                    background: 'rgba(255,255,255,0.2)',
                                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                                    fontSize: 28
                                }}>
                                    {bidang.icon}
                                </div>
                                <div>
                                    <div style={{ fontSize: 14, fontWeight: 800 }}>{bidang.name} Expert Hub</div>
                                    <div style={{ fontSize: 12, opacity: 0.9 }}>{discussions.length} Diskusi â€¢ {categoryData.materials?.length || 0} Materi</div>
                                </div>
                            </div>

                            {/* Custom Menu Bar (Tabs) */}
                            <div style={{ padding: '0 24px', position: 'relative', marginTop: -20, display: 'flex', gap: 8, overflowX: 'auto', zIndex: 10 }}>
                                {['diskusi', 'materi', 'ahli'].map(t => (
                                    <button
                                        key={t}
                                        onClick={() => setActiveTab(t)}
                                        style={{
                                            flexShrink: 0,
                                            padding: '12px 20px',
                                            borderRadius: '14px',
                                            background: activeTab === t ? (bidang.color || 'var(--primary)') : 'var(--bg-card)',
                                            color: activeTab === t ? 'white' : 'var(--text-gray)',
                                            border: `1px solid ${activeTab === t ? 'transparent' : 'var(--border)'}`,
                                            fontWeight: 800,
                                            fontSize: '13px',
                                            cursor: 'pointer',
                                            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                            textTransform: 'capitalize',
                                            boxShadow: activeTab === t ? `0 8px 16px ${bidang.color}44` : 'none',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 6
                                        }}
                                    >
                                        <Icon name={t === 'diskusi' ? 'message-circle' : t === 'materi' ? 'book-open' : 'award'} size={16} />
                                        {t === 'diskusi' ? `Diskusi (${discussions.length})` : t === 'materi' ? `Materi (${(categoryData.materials || []).length})` : t}
                                    </button>
                                ))}
                            </div>
                        </header>

                        <div className="container" style={{ padding: '24px 0' }}>
                            <div style={{ minHeight: '300px' }}>
                                {activeTab === 'diskusi' && (
                                    <div className="animate">
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                            <h3 style={{ fontSize: 16 }}>Daftar Isi Diskusi</h3>
                                            <Icon name="message-square" size={20} color="var(--primary)" />
                                        </div>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                                            {discussions.map((d, i) => (
                                                <QuestionCard
                                                    key={i}
                                                    user={d.user}
                                                    title={d.title}
                                                    tags={d.tags}
                                                    comments={d.comments}
                                                    onReply={() => handleReplyTo(d.user)}
                                                    onAddColleague={() => setShowMemberSelector(true)}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'materi' && (
                                    <div className="animate">
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                            <h3 style={{ fontSize: 16 }}>Modul Pembelajaran</h3>
                                            <button
                                                onClick={() => {
                                                    const title = prompt('Masukkan Judul Materi:');
                                                    if (title) {
                                                        const newMaterial = {
                                                            id: Date.now(),
                                                            title: title,
                                                            update: new Date().toLocaleDateString('id-ID', { month: 'short', year: 'numeric' }),
                                                            type: 'DOC',
                                                            discussions: 0,
                                                            likes: 0,
                                                            isLiked: false,
                                                            url: '#'
                                                        };
                                                        onUpdateCategoryData(bidang.name, {
                                                            ...categoryData,
                                                            materials: [newMaterial, ...(categoryData.materials || [])]
                                                        });
                                                    }
                                                }}
                                                style={{
                                                    padding: '6px 12px',
                                                    background: 'var(--primary)',
                                                    border: 'none',
                                                    borderRadius: 8,
                                                    color: 'white',
                                                    fontSize: '12px',
                                                    fontWeight: 600,
                                                    cursor: 'pointer',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: 4
                                                }}>
                                                <Icon name="plus" size={14} /> Tambah Materi
                                            </button>
                                        </div>

                                        {(categoryData.materials || []).map(mat => (
                                            <div key={mat.id} className="card" style={{ marginBottom: 16, cursor: 'pointer', transition: '0.3s' }} onClick={() => alert(`Membuka Dokumen: ${mat.title}\n\nFitur ini akan menghubungkan ke sistem penyimpanan dokumen internal perusahaaan.`)}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>
                                                    <div style={{ padding: 12, background: 'rgba(99, 102, 241, 0.1)', borderRadius: 12, color: 'var(--primary)' }}>
                                                        <Icon name={mat.type === 'PDF' ? "file-text" : "book-open"} />
                                                    </div>
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{ fontWeight: 600 }}>{mat.title}</div>
                                                        <div style={{ fontSize: 12, color: 'var(--text-gray)' }}>Update: {mat.update} â€¢ {mat.type}</div>
                                                    </div>
                                                    <Icon name="external-link" size={16} opacity={0.3} />
                                                </div>
                                                <div style={{ display: 'flex', gap: 16, borderTop: '1px solid rgba(255,255,255,0.05)', paddingTop: 12 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 12, color: 'var(--text-gray)' }}>
                                                        <Icon name="message-circle" size={16} /> {mat.discussions} Diskusi
                                                    </div>
                                                    <div
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            const updatedMaterials = categoryData.materials.map(m =>
                                                                m.id === mat.id ? { ...m, isLiked: !m.isLiked, likes: m.isLiked ? m.likes - 1 : m.likes + 1 } : m
                                                            );
                                                            onUpdateCategoryData(bidang.name, { ...categoryData, materials: updatedMaterials });
                                                        }}
                                                        style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 12, color: mat.isLiked ? '#EF4444' : 'var(--text-gray)', transition: '0.3s' }}>
                                                        <Icon name="heart" size={16} fill={mat.isLiked ? '#EF4444' : 'none'} /> {mat.likes} Suka
                                                    </div>
                                                    <div
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            globalShare({
                                                                title: mat.title,
                                                                text: `Cek materi modul pembelajaran "${bidang.name}" ini: ${mat.title}. Sangat berguna untuk referensi kerja!`,
                                                            });
                                                        }}
                                                        style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 12, color: 'var(--text-gray)', cursor: 'pointer' }}>
                                                        <Icon name="share-2" size={16} /> Bagikan
                                                    </div>
                                                </div>
                                            </div>
                                        ))}

                                        {(categoryData.materials || []).length === 0 && (
                                            <div style={{ textAlign: 'center', padding: '40px 20px', color: 'var(--text-gray)' }}>
                                                <Icon name="inbox" size={48} opacity={0.2} style={{ marginBottom: 16 }} />
                                                <p>Belum ada modul pembelajaran di bidang ini.</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                                {activeTab === 'ahli' && (
                                    <div className="animate">
                                        <h3 style={{ marginBottom: 16, fontSize: 16 }}>Konsultasi & Diskusi Ahli</h3>

                                        {/* Input Baru */}
                                        <div className="card" style={{ marginBottom: 24, padding: 16 }}>
                                            <div style={{ display: 'flex', gap: 12 }}>
                                                <div style={{ width: 40, height: 40, borderRadius: '50%', background: 'var(--primary)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
                                                    <Icon name="user" size={20} />
                                                </div>
                                                <div style={{ flex: 1 }}>
                                                    <textarea
                                                        placeholder={`Bagikan pemikiran atau materi ahli di bidang ${bidang.name}...`}
                                                        value={expertPostText}
                                                        onChange={(e) => setExpertPostText(e.target.value)}
                                                        style={{ width: '100%', background: 'transparent', border: 'none', color: 'white', resize: 'none', minHeight: 60, outline: 'none', fontSize: 14 }}
                                                    />
                                                    <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 8 }}>
                                                        <button
                                                            onClick={() => {
                                                                if (!expertPostText.trim()) return;
                                                                const newPost = {
                                                                    id: Date.now(),
                                                                    user: currentUserName || "Anda",
                                                                    role: "Ahli",
                                                                    content: expertPostText,
                                                                    timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                                                                    comments: []
                                                                };
                                                                onUpdateCategoryData(bidang.name, {
                                                                    ...categoryData,
                                                                    expertPosts: [newPost, ...(categoryData.expertPosts || [])]
                                                                });
                                                                setExpertPostText('');

                                                                // Trigger Notification
                                                                if (addNotification) {
                                                                    addNotification({
                                                                        title: 'Materi Ahli Baru',
                                                                        desc: `${currentUserName || 'Seseorang'} menambahkan materi di ${bidang.name}`,
                                                                        type: 'message',
                                                                        target: 'bidang',
                                                                        targetId: bidang.name
                                                                    });
                                                                }
                                                            }}
                                                            style={{ padding: '8px 16px', background: 'var(--primary)', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontWeight: 600, fontSize: 13 }}
                                                        >
                                                            Posting
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Daftar Postingan Ahli */}
                                        {(categoryData.expertPosts || []).length === 0 && <div style={{ textAlign: 'center', color: 'var(--text-gray)' }}>Belum ada diskusi ahli dimulai.</div>}

                                        {(categoryData.expertPosts || []).map(post => (
                                            <div key={post.id} className="card" style={{ marginBottom: 16, position: 'relative' }}>
                                                <div style={{ display: 'flex', gap: 12, marginBottom: 12 }}>
                                                    <div style={{ width: 40, height: 40, borderRadius: '50%', background: 'linear-gradient(45deg, #10B981, #3B82F6)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold' }}>
                                                        {post.user[0]}
                                                    </div>
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{ fontWeight: 600 }}>{post.user} {post.role === 'Ahli' && <Icon name="check-circle" size={12} fill="#3B82F6" color="white" />}</div>
                                                        <div style={{ fontSize: 12, color: 'var(--text-gray)' }}>{post.timestamp}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => {
                                                            if (confirm('Hapus postingan ini?')) {
                                                                const updated = (categoryData.expertPosts || []).filter(p => p.id !== post.id);
                                                                onUpdateCategoryData(bidang.name, { ...categoryData, expertPosts: updated });
                                                            }
                                                        }}
                                                        style={{ background: 'transparent', border: 'none', cursor: 'pointer', padding: 4, opacity: 0.5 }}
                                                    >
                                                        <Icon name="trash-2" size={16} color="#EF4444" />
                                                    </button>
                                                </div>

                                                <div style={{ fontSize: 14, lineHeight: 1.5, marginBottom: 16, whiteSpace: 'pre-wrap' }}>
                                                    {post.content}
                                                </div>

                                                <div style={{ borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: 12, display: 'flex', alignItems: 'center', gap: 16 }}>
                                                    <div
                                                        onClick={() => setVisibleComments(prev => ({ ...prev, [post.id]: !prev[post.id] }))}
                                                        style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 13, color: 'var(--text-gray)', cursor: 'pointer' }}
                                                    >
                                                        <Icon name="message-circle" size={18} /> {post.comments?.length || 0} Komentar
                                                    </div>
                                                </div>

                                                {/* Komentar Section */}
                                                {visibleComments[post.id] && (
                                                    <div className="animate" style={{ marginTop: 16, paddingLeft: 16, borderLeft: '2px solid rgba(255,255,255,0.1)' }}>
                                                        <div style={{ display: 'flex', flexDirection: 'column', gap: 12, marginBottom: 16 }}>
                                                            {(post.comments || []).map(c => (
                                                                <div key={c.id} style={{ fontSize: 13 }}>
                                                                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                                        <span style={{ fontWeight: 700, color: '#ddd' }}>{c.user}</span>
                                                                        <span style={{ fontSize: 10, color: 'var(--text-gray)' }}>{c.timestamp}</span>
                                                                    </div>
                                                                    <div style={{ color: 'var(--text-gray)' }}>{c.text}</div>
                                                                </div>
                                                            ))}
                                                        </div>

                                                        <div style={{ display: 'flex', gap: 8 }}>
                                                            <input
                                                                type="text"
                                                                placeholder="Tulis komentar..."
                                                                value={commentInputs[post.id] || ''}
                                                                onChange={e => setCommentInputs(prev => ({ ...prev, [post.id]: e.target.value }))}
                                                                style={{ flex: 1, padding: '8px 12px', borderRadius: 20, background: 'rgba(255,255,255,0.05)', border: 'none', color: 'white', fontSize: 13 }}
                                                                onKeyDown={(e) => {
                                                                    if (e.key === 'Enter') {
                                                                        const txt = commentInputs[post.id];
                                                                        if (!txt?.trim()) return;
                                                                        const newComment = { id: Date.now(), user: currentUserName || 'Anda', text: txt, timestamp: 'Baru saja' };

                                                                        const updatedPosts = categoryData.expertPosts.map(p => {
                                                                            if (p.id === post.id) {
                                                                                return { ...p, comments: [...(p.comments || []), newComment] };
                                                                            }
                                                                            return p;
                                                                        });

                                                                        onUpdateCategoryData(bidang.name, { ...categoryData, expertPosts: updatedPosts });
                                                                        setCommentInputs(prev => ({ ...prev, [post.id]: '' }));

                                                                        if (addNotification) {
                                                                            addNotification({
                                                                                title: 'Komentar Baru',
                                                                                desc: `${currentUserName || 'Seseorang'} mengomentari materi di ${bidang.name}`,
                                                                                type: 'message',
                                                                                target: 'bidang',
                                                                                targetId: bidang.name
                                                                            });
                                                                        }
                                                                    }
                                                                }}
                                                            />
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Public Chat Input Area (Always visible for members to see everything) */}
                            <div style={{ marginTop: 20, background: 'rgba(255,255,255,0.03)', padding: 16, borderRadius: 20, border: '1px solid var(--border)' }}>
                                <div style={{ fontSize: 11, color: 'var(--text-gray)', marginBottom: 10, display: 'flex', alignItems: 'center', gap: 6 }}>
                                    <Icon name="globe" size={12} /> {activeTab === 'diskusi' ? 'Gunakan @nama untuk membalas diskusi' : `Tulis pesan di forum publik ${bidang.name}`}
                                </div>
                                <div style={{ display: 'flex', gap: 10 }}>
                                    <input
                                        ref={inputRef}
                                        type="text"
                                        placeholder={activeTab === 'diskusi' ? "Tanya sesuatu atau @balas..." : "Tulis pendapat atau pertanyaanmu..."}
                                        style={{ flex: 1, background: 'rgba(0,0,0,0.2)', border: '1px solid var(--border)', borderRadius: 10, padding: '10px 14px', color: 'white', fontSize: 13, outline: 'none' }}
                                        value={msg}
                                        onChange={e => setMsg(e.target.value)}
                                        onKeyDown={e => e.key === 'Enter' && handleSend()}
                                    />
                                    <button
                                        onClick={handleSend}
                                        style={{ width: 40, height: 40, borderRadius: 10, background: 'var(--primary)', border: 'none', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer' }}>
                                        <Icon name="send" size={18} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </Background3D>
            );
        };

        const Home = ({ userName, userRole, checkPermission, onCreateQuestion, onBidangClick, onNavigate, onOpenDB, onLogout, knowledgeBase, getCategoryCount }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [searchSource, setSearchSource] = useState('internal'); // internal, google, chatgpt, youtube
            const [showSourceSelector, setShowSourceSelector] = useState(false);
            const [showMoreMenu, setShowMoreMenu] = useState(false);
            const [selectedKnowledge, setSelectedKnowledge] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);

            const searchSources = [
                { id: 'internal', name: 'Internal', icon: 'search', color: 'var(--primary)', placeholder: 'Cari bidang...' },
                { id: 'google', name: 'Google', icon: 'globe', color: '#4285F4', placeholder: 'Ketik & cari di Google...' },
                { id: 'chatgpt', name: 'ChatGPT', icon: 'zap', color: '#10a37f', placeholder: 'Tanya AI (ChatGPT)...' },
                { id: 'youtube', name: 'YouTube', icon: 'video', color: '#FF0000', placeholder: 'Cari panduan video...' }
            ];

            const activeSource = searchSources.find(s => s.id === searchSource);

            const handleSearchAction = () => {
                const query = searchTerm.trim();

                if (searchSource === 'google') {
                    window.open(query ? `https://www.google.com/search?q=${encodeURIComponent(query)}` : 'https://www.google.com', '_blank');
                } else if (searchSource === 'chatgpt') {
                    window.open(query ? `https://chatgpt.com/?q=${encodeURIComponent(query)}` : 'https://chatgpt.com', '_blank');
                } else if (searchSource === 'youtube') {
                    window.open(query ? `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}` : 'https://www.youtube.com', '_blank');
                }
                // internal search is handled by filtering the list automatically
            };

            const bidangFavorit = [
                { name: 'Hardware', icon: <img src="ICON HDW.png" alt="Hardware" style={{ width: '100%', height: '100%', objectFit: 'contain', filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.2))' }} />, color: '#3B82F6', count: '245' },
                { name: 'Software', icon: 'ðŸ’¿', color: '#8B5CF6', count: '189' },
                { name: 'Network', icon: 'ðŸŒ', color: '#10B981', count: '156' },
                { name: 'Runtimes', icon: 'âš¡', color: '#F59E0B', count: '98' },
                { name: 'Development', icon: 'ðŸ’»', color: '#EC4899', count: '203' },
                { name: 'Security', icon: 'ðŸ›¡ï¸', color: '#EF4444', count: '142' },
                { name: 'Database', icon: 'ðŸ—„ï¸', color: '#F59E0B', count: '88' },
                { name: 'Cloud', icon: 'â˜ï¸', color: '#0EA5E9', count: '120' }
            ];

            const filteredBidang = bidangFavorit.filter(b =>
                b.name.toLowerCase().startsWith(searchTerm.toLowerCase())
            );

            const questions = [
                { user: "Ahmad Rizky", title: "Laptop tidak bisa connect ke WiFi kantor setelah update Windows", tags: ["Network", "Hardware"], time: "2m lalu" },
                { user: "Budi Santoso", title: "Error runtime saat menjalankan aplikasi Node.js", tags: ["Runtimes", "Development"], time: "15m lalu" },
                { user: "Dewi Lestari", title: "Cara install driver printer HP di Mac M2?", tags: ["Hardware", "Software"], time: "1j lalu" },
                { user: "Siti Aminah", title: "Database connection lost saat high traffic", tags: ["Database", "Backend"], time: "2j lalu" },
                { user: "Rudi Hermawan", title: "Rekomendasi text editor ringan untuk PC kentang", tags: ["Software", "Tools"], time: "3j lalu" }
            ];

            useEffect(() => {
                const handleClickOutside = () => {
                    setShowSourceSelector(false);
                    setShowMoreMenu(false);
                };
                if (showSourceSelector || showMoreMenu) {
                    window.addEventListener('click', handleClickOutside);
                    return () => window.removeEventListener('click', handleClickOutside);
                }
            }, [showSourceSelector, showMoreMenu]);

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate">
                        <header className="page-header" style={{
                            position: 'sticky',
                            top: 0,
                            zIndex: 100,
                            padding: '12px 16px 16px', // Ultra-compact padding
                            borderBottomLeftRadius: 20, // Professional sharp radius
                            borderBottomRightRadius: 20,
                            background: `linear-gradient(135deg, ${searchSource === 'internal' ? 'var(--primary)' : activeSource.color + 'aa'}, var(--secondary))`,
                            transition: 'background 0.5s ease',
                            boxShadow: `0 15px 30px ${searchSource === 'internal' ? 'rgba(0,0,0,0.2)' : activeSource.color + '22'}`,
                        }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                <div>
                                    <h1 style={{ fontSize: '20px', fontWeight: '700', color: 'white' }}>Beranda</h1>
                                    <p style={{ color: 'rgba(255,255,255,0.8)', fontSize: '11px', marginTop: 0 }}>
                                        Selamat datang, {userName || 'Karyawan'}!
                                        <span style={{
                                            display: 'inline-block',
                                            marginLeft: '6px',
                                            padding: '1px 6px',
                                            borderRadius: '4px',
                                            background: 'rgba(99, 102, 241, 0.2)',
                                            color: '#818cf8',
                                            fontSize: '9px',
                                            fontWeight: '700',
                                            border: '1px solid rgba(99, 102, 241, 0.3)',
                                            verticalAlign: 'middle'
                                        }}>{userRole}</span>
                                    </p>
                                </div>
                                <div style={{ position: 'relative' }}>
                                    <div
                                        onClick={(e) => { e.stopPropagation(); setShowMoreMenu(!showMoreMenu); }}
                                        style={{
                                            cursor: 'pointer',
                                            width: 34, // Compact
                                            height: 34, // Compact
                                            background: 'rgba(255,255,255,0.15)',
                                            borderRadius: '12px',
                                            color: 'white',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            border: '1px solid rgba(255,255,255,0.2)',
                                            backdropFilter: 'blur(10px)',
                                            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                            transform: showMoreMenu ? 'rotate(90deg)' : 'rotate(0deg)',
                                            boxShadow: showMoreMenu ? `0 0 15px ${searchSource === 'internal' ? 'rgba(255,255,255,0.3)' : activeSource.color + '66'}` : 'none'
                                        }}
                                        onMouseOver={e => e.currentTarget.style.background = 'rgba(255,255,255,0.25)'}
                                        onMouseOut={e => e.currentTarget.style.background = 'rgba(255,255,255,0.15)'}
                                    >
                                        <Icon name="more-vertical" size={20} />
                                    </div>

                                    {showMoreMenu && (
                                        <div className="animate" style={{
                                            position: 'absolute',
                                            top: 'calc(100% + 12px)',
                                            right: 0,
                                            zIndex: 10000,
                                            width: 220,
                                            padding: 10,
                                            background: 'rgba(15, 23, 42, 0.95)',
                                            borderRadius: 20,
                                            border: `1px solid ${searchSource === 'internal' ? 'rgba(255,255,255,0.1)' : activeSource.color + '44'}`,
                                            backdropFilter: 'blur(30px)',
                                            boxShadow: '0 30px 60px rgba(0,0,0,0.8)',
                                            overflow: 'hidden'
                                        }}>
                                            {/* User Quick Info */}
                                            <div style={{ padding: '12px 14px', marginBottom: 8, borderBottom: '1px solid rgba(255,255,255,0.05)' }}>
                                                <div style={{ fontSize: 13, fontWeight: 700, color: 'white' }}>{userName || 'Karyawan'}</div>
                                                <div style={{ fontSize: 10, color: 'var(--text-gray)' }}>Role: {userRole} â€¢ Status: Active ðŸŸ¢</div>
                                            </div>

                                            {[
                                                { icon: 'user', label: 'Profil Saya', desc: 'Kelola data diri & badge', color: '#3B82F6', target: 'profil' },
                                                { icon: 'bell', label: 'Notifikasi', desc: 'Pesan & update terbaru', color: '#F59E0B', target: 'notif' },
                                                { icon: 'history', label: 'Riwayat Diskusi', desc: 'Lihat tanya jawab lama', color: '#8B5CF6', target: 'pesan' },
                                                { type: 'divider' },
                                                { icon: 'life-buoy', label: 'Pusat Bantuan', desc: 'Informasi tentang aplikasi', color: '#10B981', target: 'bantuan' },
                                                { icon: 'settings', label: 'Pengaturan', desc: 'Konfigurasi Aplikasi', color: '#64748B', target: 'profil' },
                                                // Admin Only DB Menu
                                                ...(checkPermission('create_user') ? [{ icon: 'database', label: 'Database Manager', desc: 'DBeaver Lite Console', color: '#10B981', action: 'opendb' }] : []),
                                                { type: 'divider' },
                                                { icon: 'power', label: 'Log Out', desc: 'Keluar dari sesi ini', color: '#EF4444', action: 'logout' }
                                            ].map((item, idx) => (
                                                item.type === 'divider' ? (
                                                    <div key={idx} style={{ height: 1, background: 'rgba(255,255,255,0.08)', margin: '6px 12px' }} />
                                                ) : (
                                                    <div
                                                        key={idx}
                                                        style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: 12,
                                                            padding: '10px 14px',
                                                            borderRadius: 14,
                                                            cursor: 'pointer',
                                                            transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)'
                                                        }}
                                                        onMouseOver={e => {
                                                            e.currentTarget.style.background = `${item.color}15`;
                                                            e.currentTarget.style.transform = 'translateX(4px)';
                                                        }}
                                                        onMouseOut={e => {
                                                            e.currentTarget.style.background = 'transparent';
                                                            e.currentTarget.style.transform = 'translateX(0)';
                                                        }}
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setShowMoreMenu(false);
                                                            if (item.action === 'logout') {
                                                                onLogout();
                                                            } else if (item.action === 'opendb') {
                                                                onOpenDB();
                                                            } else if (item.target) {
                                                                onNavigate(item.target);
                                                            }
                                                        }}
                                                    >
                                                        <div style={{
                                                            width: 32, height: 32,
                                                            borderRadius: 10,
                                                            background: `${item.color}22`,
                                                            display: 'flex', alignItems: 'center', justifyContent: 'center',
                                                            border: `1px solid ${item.color}33`
                                                        }}>
                                                            <Icon name={item.icon} size={16} color={item.color} />
                                                        </div>
                                                        <div style={{ flex: 1 }}>
                                                            <div style={{ fontSize: 13, fontWeight: 700, color: 'white' }}>{item.label}</div>
                                                            <div style={{ fontSize: 9, color: 'var(--text-gray)', fontWeight: 500 }}>{item.desc}</div>
                                                        </div>
                                                        <Icon name="chevron-right" size={12} color="rgba(255,255,255,0.2)" />
                                                    </div>
                                                )
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div style={{ position: 'relative' }}>
                                <div className="search-bar" style={{
                                    background: 'rgba(255,255,255,0.15)',
                                    border: `1.5px solid ${searchSource === 'internal' ? 'rgba(255,255,255,0.2)' : activeSource.color}`,
                                    marginTop: 10, // Ultra-compact margin
                                    transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                                    boxShadow: searchSource === 'internal' ? 'none' : `0 0 20px ${activeSource.color}44`,
                                    backdropFilter: 'blur(10px)'
                                }}>
                                    <div
                                        onClick={(e) => { e.stopPropagation(); setShowSourceSelector(!showSourceSelector); }}
                                        style={{
                                            cursor: 'pointer',
                                            padding: '4px 8px', // Reduced padding
                                            background: 'rgba(255,255,255,0.1)',
                                            borderRadius: 10,
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 8,
                                            marginRight: 6,
                                            transition: 'all 0.3s',
                                            border: `1px solid ${searchSource === 'internal' ? 'transparent' : activeSource.color + '33'}`
                                        }}
                                        onMouseOver={e => e.currentTarget.style.background = 'rgba(255,255,255,0.2)'}
                                        onMouseOut={e => e.currentTarget.style.background = 'rgba(255,255,255,0.1)'}
                                    >
                                        <Icon name={activeSource.icon} color={searchSource === 'internal' ? 'white' : activeSource.color} size={18} />
                                        <Icon name="chevron-down" size={12} color="rgba(255,255,255,0.6)" />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder={activeSource.placeholder}
                                        style={{ color: 'white', fontWeight: '500' }}
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && handleSearchAction()}
                                    />
                                    {searchTerm && (
                                        <div
                                            onClick={handleSearchAction}
                                            className="animate-pulse"
                                            style={{
                                                cursor: 'pointer',
                                                padding: '8px 12px',
                                                background: activeSource.color,
                                                borderRadius: 10,
                                                marginLeft: 8,
                                                boxShadow: `0 4px 12px ${activeSource.color}66`
                                            }}
                                        >
                                            <Icon name="arrow-right" size={18} color="white" />
                                        </div>
                                    )}
                                </div>

                                {/* Source Selector Menu (Maximized UI) */}
                                {showSourceSelector && (
                                    <div className="animate" style={{
                                        position: 'absolute',
                                        top: 'calc(100% + 12px)',
                                        left: 0,
                                        zIndex: 9999,
                                        padding: 10,
                                        width: 240,
                                        background: 'rgba(15, 23, 42, 0.9)',
                                        borderRadius: 20,
                                        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.7)',
                                        border: `1px solid ${activeSource.color}55`,
                                        backdropFilter: 'blur(24px)',
                                        overflow: 'hidden'
                                    }}>
                                        <div style={{ fontSize: 11, color: 'var(--text-gray)', padding: '6px 14px 10px', textTransform: 'uppercase', letterSpacing: 1.5, fontWeight: 700 }}>Sumber Bantuan</div>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: 6 }}>
                                            {searchSources.map(s => (
                                                <div
                                                    key={s.id}
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        setSearchSource(s.id);
                                                        setShowSourceSelector(false);
                                                    }}
                                                    style={{
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: 14,
                                                        padding: '12px 14px',
                                                        borderRadius: 14,
                                                        cursor: 'pointer',
                                                        background: searchSource === s.id ? `${s.color}22` : 'transparent',
                                                        transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                                                        border: `1px solid ${searchSource === s.id ? s.color + '44' : 'transparent'}`
                                                    }}
                                                    onMouseOver={e => e.currentTarget.style.background = `${s.color}11`}
                                                    onMouseOut={e => e.currentTarget.style.background = searchSource === s.id ? `${s.color}22` : 'transparent'}
                                                >
                                                    <div style={{
                                                        width: 36, height: 36,
                                                        borderRadius: 10,
                                                        background: searchSource === s.id ? s.color : `${s.color}22`,
                                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                                        transition: 'all 0.3s'
                                                    }}>
                                                        <Icon name={s.icon} color={searchSource === s.id ? 'white' : s.color} size={20} />
                                                    </div>
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{ fontSize: 13, fontWeight: 700, color: searchSource === s.id ? 'white' : 'rgba(255,255,255,0.7)' }}>{s.name}</div>
                                                        <div style={{ fontSize: 10, color: 'var(--text-gray)' }}>Buka {s.name}</div>
                                                    </div>
                                                    {searchSource === s.id && (
                                                        <div style={{ width: 8, height: 8, borderRadius: '50%', background: s.color, boxShadow: `0 0 10px ${s.color}` }}></div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Quick External Links (Premium Cards) */}
                            <div style={{ display: 'flex', gap: 8, marginTop: 8 }}>
                                <button
                                    onClick={() => window.open(searchTerm.trim() ? `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}` : 'https://www.google.com', '_blank')}
                                    style={{
                                        flex: 1, padding: '6px 10px', // Ultra-compact padding
                                        background: 'rgba(255,255,255,0.95)',
                                        color: '#4285F4', borderRadius: 12, // Smaller radius
                                        border: 'none', fontSize: 11, fontWeight: 700, // Smaller font
                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                        gap: 10, cursor: 'pointer',
                                        boxShadow: '0 8px 16px rgba(0,0,0,0.15)',
                                        transition: 'transform 0.2s'
                                    }}
                                    onMouseOver={e => e.currentTarget.style.transform = 'translateY(-2px)'}
                                    onMouseOut={e => e.currentTarget.style.transform = 'translateY(0)'}
                                >
                                    <img src="https://www.google.com/favicon.ico" style={{ width: 14 }} /> Google
                                </button>
                                <button
                                    onClick={() => window.open(searchTerm.trim() ? `https://chatgpt.com/?q=${encodeURIComponent(searchTerm)}` : 'https://chatgpt.com', '_blank')}
                                    style={{
                                        flex: 1, padding: '6px 10px',
                                        background: '#10a37f',
                                        color: 'white', borderRadius: 12,
                                        border: 'none', fontSize: 11, fontWeight: 700,
                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                        gap: 10, cursor: 'pointer',
                                        boxShadow: '0 8px 20px rgba(16,163,127,0.3)',
                                        transition: 'transform 0.2s'
                                    }}
                                    onMouseOver={e => e.currentTarget.style.transform = 'translateY(-2px)'}
                                    onMouseOut={e => e.currentTarget.style.transform = 'translateY(0)'}
                                >
                                    <Icon name="zap" size={14} /> ChatGPT
                                </button>
                            </div>
                        </header>

                        <div className="container" style={{ paddingBottom: 40 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, padding: '0 16px' }}>
                                <h3 style={{ fontSize: 18, fontWeight: 800 }}>Bidang Favorit</h3>
                                <div onClick={() => onNavigate('bidang')} style={{ fontSize: 13, color: 'var(--primary)', fontWeight: 700, cursor: 'pointer' }}>Lihat Semua</div>
                            </div>

                            <div className="favorites-grid" style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fill, minmax(clamp(130px, 15vw, 160px), 1fr))',
                                gap: 'var(--gap-responsive)'
                            }}>
                                {filteredBidang.map(b => (
                                    <div key={b.name}
                                        className="card bidang-card"
                                        style={{
                                            '--glow-color': b.color,
                                            padding: '24px 16px',
                                            cursor: 'pointer'
                                        }}
                                        onClick={() => onBidangClick && onBidangClick(b)}
                                    >
                                        <div className="category-glow-bg"></div>
                                        <div className="icon-container-3d" style={{ width: 64, height: 64, marginBottom: 16 }}>
                                            <div className="icon-box" style={{ fontSize: 'clamp(28px, 5vw, 36px)', borderRadius: 16 }}>
                                                {b.icon}
                                            </div>
                                            <div className="icon-shadow-3d" style={{ width: 40, height: 8 }}></div>
                                        </div>
                                        <div style={{
                                            fontSize: '13px',
                                            fontWeight: '800',
                                            color: 'white',
                                            marginBottom: 2,
                                            zIndex: 10
                                        }}>{b.name}</div>
                                        <div style={{
                                            fontSize: '10px',
                                            color: b.color,
                                            fontWeight: 700,
                                            textTransform: 'uppercase',
                                            letterSpacing: 0.5,
                                            zIndex: 10
                                        }}>{getCategoryCount ? getCategoryCount(b.name) : 0} Topik</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div style={{ paddingBottom: 20 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 10, padding: '0 16px' }}>
                                <div>
                                    <h3 style={{ fontSize: 'clamp(15px, 4vw, 18px)', fontWeight: '800' }}>Deep-AI Analysis Base</h3>
                                    <p style={{ fontSize: 11, color: 'var(--text-gray)', marginTop: 4 }}>Validasi otomatis tiap 24 jam</p>
                                </div>
                                <div style={{ fontSize: 13, color: 'var(--primary)', fontWeight: 700, cursor: 'pointer' }}>Eksplorasi</div>
                            </div>
                            <div className="content-scroll-area">
                                <KnowledgeFeed
                                    searchTerm={searchTerm}
                                    knowledgeBase={knowledgeBase}
                                    onKnowledgeClick={(k) => {
                                        setSelectedKnowledge(k);
                                        setIsAnalyzing(true);
                                        setTimeout(() => setIsAnalyzing(false), 2000);
                                    }}
                                />
                            </div>
                        </div>

                        {/* AI Analysis Modal Overlay */}
                        {
                            selectedKnowledge && (
                                <div style={{
                                    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
                                    background: 'rgba(0,0,0,0.9)', backdropFilter: 'blur(15px)',
                                    zIndex: 30000, display: 'flex', alignItems: 'center', justifyContent: 'center',
                                    padding: 20
                                }} onClick={() => setSelectedKnowledge(null)}>
                                    <div className="animate" style={{
                                        maxWidth: 650, width: '100%', background: 'var(--bg-card)',
                                        borderRadius: 32, border: '1px solid var(--primary)',
                                        maxHeight: '90vh', overflowY: 'auto', padding: 0,
                                        position: 'relative', boxShadow: '0 0 80px rgba(99, 102, 241, 0.4)',
                                        overflow: 'hidden'
                                    }} onClick={e => e.stopPropagation()}>
                                        {isAnalyzing && (
                                            <div style={{
                                                position: 'absolute', top: 0, left: 0, right: 0, bottom: 0,
                                                background: 'rgba(15, 23, 42, 0.95)', zIndex: 40000,
                                                display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
                                                gap: 20
                                            }}>
                                                <div className="animate-pulse" style={{ width: 80, height: 80, borderRadius: '50%', border: '4px solid var(--primary)', borderTopColor: 'transparent', animation: 'spin 1.5s linear infinite' }}></div>
                                                <div style={{ color: 'white', fontWeight: 800, fontSize: 18 }}>AI Sedang Mendalami Kasus...</div>
                                                <div style={{ color: 'var(--text-gray)', fontSize: 12 }}>Mengsinkronisasi Data Terbaru dari Google & Knowledge Base</div>
                                            </div>
                                        )}
                                        {/* Header Modal */}
                                        <div style={{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))', padding: '24px 30px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 15 }}>
                                                <div style={{ width: 44, height: 44, background: 'rgba(255,255,255,0.2)', borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                                    <Icon name="brain-circuit" size={24} color="white" />
                                                </div>
                                                <div>
                                                    <div style={{ fontSize: 18, fontWeight: 900, color: 'white' }}>Laporan Analisa Deep-AI</div>
                                                    <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.7)', fontWeight: 600 }}>Sinkronisasi Google Data + AI Real-time</div>
                                                </div>
                                            </div>
                                            <div onClick={() => setSelectedKnowledge(null)} style={{ cursor: 'pointer', background: 'rgba(0,0,0,0.2)', padding: 10, borderRadius: '50%', color: 'white' }}><Icon name="x" size={20} /></div>
                                        </div>

                                        <div style={{ padding: 30 }}>
                                            {/* Question Section */}
                                            <div style={{ marginBottom: 24 }}>
                                                <div style={{ fontSize: 11, fontWeight: 800, color: 'var(--primary)', marginBottom: 10, textTransform: 'uppercase', letterSpacing: 1.5, display: 'flex', justifyContent: 'space-between' }}>
                                                    <span>Ringkasan Masalah</span>
                                                    <span style={{ color: '#10B981' }}>Live Analysis: {new Date().toLocaleTimeString()}</span>
                                                </div>
                                                <div style={{ fontSize: 16, fontWeight: 700, color: 'white', lineHeight: 1.5, background: 'rgba(99, 102, 241, 0.05)', padding: 16, borderRadius: 16, borderLeft: '4px solid var(--primary)' }}>
                                                    "{selectedKnowledge.question}"
                                                </div>
                                            </div>

                                            {/* AI Crawling Section */}
                                            <div style={{ marginBottom: 24, display: 'grid', gridTemplateColumns: 'minmax(0, 1fr) minmax(0, 1fr)', gap: 16 }}>
                                                <div className="card" style={{ background: 'rgba(16, 185, 129, 0.05)', padding: 16, borderRadius: 20, border: '1px solid rgba(16, 185, 129, 0.1)', margin: 0 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#10B981', marginBottom: 10 }}>
                                                        <Icon name="activity" size={16} />
                                                        <div style={{ fontSize: 11, fontWeight: 800 }}>AI CRAWLING ENGINE</div>
                                                    </div>
                                                    <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, marginBottom: 12 }}>{selectedKnowledge.aiCrawling}</div>
                                                    <button
                                                        onClick={() => alert('Membuka detail resource AI...')}
                                                        style={{ background: 'rgba(16, 185, 129, 0.1)', border: 'none', borderRadius: 8, color: '#10B981', fontSize: 10, fontWeight: 700, padding: '6px 10px', cursor: 'pointer' }}>
                                                        Check Resource
                                                    </button>
                                                </div>
                                                <div className="card" style={{ background: 'rgba(66, 133, 244, 0.05)', padding: 16, borderRadius: 20, border: '1px solid rgba(66, 133, 244, 0.1)', margin: 0 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#4285F4', marginBottom: 10 }}>
                                                        <Icon name="search" size={16} />
                                                        <div style={{ fontSize: 11, fontWeight: 800 }}>GOOGLE SEARCH INSIGHT</div>
                                                    </div>
                                                    <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, whiteSpace: 'pre-line', marginBottom: 12 }}>{selectedKnowledge.googleInsight}</div>
                                                    <button
                                                        onClick={() => window.open(`https://www.google.com/search?q=${encodeURIComponent(selectedKnowledge.title)}`, '_blank')}
                                                        style={{ background: 'rgba(66, 133, 244, 0.1)', border: 'none', borderRadius: 8, color: '#4285F4', fontSize: 10, fontWeight: 700, padding: '6px 10px', cursor: 'pointer' }}>
                                                        Go to Google
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Detailed Analysis Section */}
                                            <div style={{ background: 'rgba(255,255,255,0.03)', padding: 24, borderRadius: 24, border: '1px solid var(--border)' }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 16 }}>
                                                    <Icon name="clipboard-check" color="var(--primary)" size={18} />
                                                    <div style={{ fontSize: 13, fontWeight: 800, color: 'white' }}>SOLUSI & LANGKAH PERBAIKAN</div>
                                                </div>
                                                <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.8)', lineHeight: 1.8, whiteSpace: 'pre-line' }}>
                                                    {selectedKnowledge.analysis}
                                                </div>
                                            </div>

                                            <div style={{ display: 'flex', gap: 12, marginTop: 30 }}>
                                                <button
                                                    onClick={() => {
                                                        navigator.clipboard.writeText(selectedKnowledge.analysis);
                                                        alert('Solusi berhasil disalin ke clipboard!');
                                                    }}
                                                    style={{
                                                        flex: 1, padding: '16px',
                                                        background: 'rgba(255,255,255,0.05)',
                                                        border: '1px solid var(--border)', borderRadius: 16, color: 'white',
                                                        fontWeight: 800, fontSize: 14, cursor: 'pointer',
                                                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8
                                                    }}>
                                                    <Icon name="copy" size={18} /> Salin Solusi
                                                </button>
                                                <button
                                                    onClick={() => globalShare({ title: selectedKnowledge.title, text: selectedKnowledge.analysis })}
                                                    style={{
                                                        flex: 1, padding: '16px',
                                                        background: 'linear-gradient(135deg, var(--primary), var(--secondary))',
                                                        border: 'none', borderRadius: 16, color: 'white',
                                                        fontWeight: 800, fontSize: 14, cursor: 'pointer',
                                                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8,
                                                        boxShadow: '0 10px 25px rgba(99, 102, 241, 0.3)'
                                                    }}>
                                                    <Icon name="share-2" size={18} /> Bagikan
                                                </button>
                                            </div>
                                            <button
                                                onClick={() => setSelectedKnowledge(null)}
                                                style={{ width: '100%', padding: '12px', background: 'transparent', border: 'none', color: 'var(--text-gray)', fontSize: 13, fontWeight: 600, marginTop: 16, cursor: 'pointer' }}>
                                                Tutup Laporan
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )
                        }

                        <div className="fab" onClick={onCreateQuestion}>
                            <Icon name="plus" color="white" size={28} />
                        </div>
                    </div >
                </Background3D >
            );
        };

        // --- Anggota (Membership & Friends) Screen ---
        const Anggota = ({ isPrivateMode }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const members = [
                { id: 1, name: 'Budi Santoso', role: 'IT Support Senior', status: 'Online', isFriend: true, image: 'https://i.pravatar.cc/150?u=1', isPrivate: false },
                { id: 2, name: 'Siti Aminah', role: 'Database Admin', status: 'Baru Bergabung', isFriend: false, image: 'https://i.pravatar.cc/150?u=2', isPrivate: true },
                { id: 3, name: 'Ahmad Rizky', role: 'Network Engineer', status: 'Online', isFriend: true, image: 'https://i.pravatar.cc/150?u=3', isPrivate: false },
                { id: 4, name: 'Dewi Lestari', role: 'Software Developer', status: 'Baru Bergabung', isFriend: false, image: 'https://i.pravatar.cc/150?u=4', isPrivate: false },
                { id: 5, name: 'Rudi Hermawan', role: 'Security Analyst', status: 'Offline', isFriend: false, image: 'https://i.pravatar.cc/150?u=5', isPrivate: true },
                { id: 6, name: 'Agus Setiawan', role: 'Cloud Architect', status: 'Online', isFriend: false, image: 'https://i.pravatar.cc/150?u=6', isPrivate: false }
            ];

            const filteredMembers = members.filter(m =>
                m.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                m.role.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <Background3D color1="var(--primary)" color2="var(--secondary)">
                    <div className="animate">
                        <header className="page-header" style={{ background: 'linear-gradient(135deg, var(--primary), var(--secondary))' }}>
                            <h1 style={{ fontSize: '24px', fontWeight: '800', color: 'white' }}>Anggota</h1>
                            <p style={{ color: 'rgba(255,255,255,0.8)', fontSize: '13px', marginTop: 4 }}>Privasi Anda prioritas kami. Nama anggota yang mengaktifkan mode privat akan disamarkan.</p>
                            <div className="search-bar" style={{ background: 'rgba(255,255,255,0.2)', border: 'none', marginTop: 16 }}>
                                <Icon name="search" color="white" />
                                <input
                                    type="text"
                                    placeholder="Cari nama atau divisi..."
                                    style={{ color: 'white' }}
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </header>

                        <div style={{ padding: '24px' }}>
                            <h3 style={{ fontSize: 16, marginBottom: 16 }}>Saran Koneksi Baru</h3>
                            <div className="horizontal-scroll" style={{ paddingBottom: 16, marginBottom: 8 }}>
                                {members.filter(m => m.status === 'Baru Bergabung').map(m => (
                                    <div key={m.id} className="card" style={{ minWidth: 140, textAlign: 'center', padding: 16, margin: 0 }}>
                                        <div style={{ width: 60, height: 60, borderRadius: '50%', margin: '0 auto 12px', border: '2px solid var(--primary)', padding: 2 }}>
                                            <img src={m.isPrivate ? 'https://www.w3schools.com/howto/img_avatar.png' : m.image} style={{ width: '100%', height: '100%', borderRadius: '50%', objectFit: 'cover', filter: m.isPrivate ? 'grayscale(1) blur(2px)' : 'none' }} />
                                        </div>
                                        <div style={{ fontWeight: 700, fontSize: 13, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                            {m.isPrivate ? 'Anggota Privat' : m.name}
                                        </div>
                                        <div style={{ fontSize: 10, color: 'var(--text-gray)', marginBottom: 12 }}>{m.role}</div>
                                        <button style={{ width: '100%', padding: '6px', background: 'var(--primary)', border: 'none', borderRadius: 8, color: 'white', fontSize: 11, fontWeight: 600 }}>Tambah</button>
                                    </div>
                                ))}
                            </div>

                            <h3 style={{ fontSize: 16, marginBottom: 16, marginTop: 16 }}>Daftar Anggota</h3>
                            <div className="grid-responsive">
                                {filteredMembers.map(m => (
                                    <div key={m.id} className="card" style={{ display: 'flex', alignItems: 'center', gap: 16, padding: 16 }}>
                                        <div style={{ position: 'relative' }}>
                                            <img src={m.isPrivate ? 'https://www.w3schools.com/howto/img_avatar.png' : m.image} style={{ width: 50, height: 50, borderRadius: '50%', objectFit: 'cover', filter: m.isPrivate ? 'grayscale(1) blur(1px)' : 'none' }} />
                                            <div style={{
                                                position: 'absolute', bottom: 2, right: 2, width: 12, height: 12, borderRadius: '50%',
                                                background: m.status === 'Online' ? '#10B981' : (m.status === 'Baru Bergabung' ? '#3B82F6' : '#8B949E'),
                                                border: '2px solid var(--bg-card)'
                                            }}></div>
                                        </div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: 700, fontSize: 15 }}>{m.isPrivate ? 'Anggota Privat' : m.name}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text-gray)' }}>{m.role}</div>
                                        </div>
                                        <button style={{
                                            padding: '8px 16px', background: m.isFriend ? 'rgba(255,255,255,0.05)' : 'var(--primary)',
                                            border: m.isFriend ? '1px solid var(--border)' : 'none', borderRadius: 12,
                                            color: m.isFriend ? 'var(--text-gray)' : 'white', fontSize: 12, fontWeight: 600, cursor: 'pointer'
                                        }}>
                                            {m.isFriend ? 'Teman' : 'Tambah'}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </Background3D>
            );
        };

        // --- REDIS DATABASE SIMULATION LAYER ---
        // Kelas ini mensimulasikan koneksi Database Redis menggunakan LocalStorage
        // Memungkinkan aplikasi berfungsi seolah memiliki backend DB saat berjalan di sisi klien.
        class RedisClient {
            constructor() {
                this.prefix = 'bb_redis_db:';
                this.connected = true;
                console.log('ðŸ”Œ Redis Client Connected to 127.0.0.1:6379 (Simulation Mode)');
            }

            _k(key) { return this.prefix + key; }

            // GET key: Mengambil data JSON
            get(key, defaultValue = null) {
                try {
                    const val = localStorage.getItem(this._k(key));
                    // Jika data tidak ada di "Redis", cek apakah data lama (migrasi) ada
                    if (!val) {
                        const legacy = localStorage.getItem('bb_' + key);
                        if (legacy) {
                            this.set(key, JSON.parse(legacy)); // Migrasi otomatis
                            return JSON.parse(legacy);
                        }
                        return defaultValue;
                    }
                    return JSON.parse(val);
                } catch (e) {
                    console.error('Redis GET Error:', e);
                    return defaultValue;
                }
            }

            // SET key value: Menyimpan data
            set(key, value) {
                try {
                    localStorage.setItem(this._k(key), JSON.stringify(value));
                    return "OK";
                } catch (e) {
                    console.error('Redis SET Error:', e);
                    return "ERR";
                }
            }

            // DEL key: Hapus data
            del(key) {
                localStorage.removeItem(this._k(key));
                return 1;
            }

            // FLUSHDB: Bersihkan database
            flushdb() {
                Object.keys(localStorage).forEach(k => {
                    if (k.startsWith(this.prefix)) localStorage.removeItem(k);
                });
                return "OK";
            }
        }

        // Inisialisasi Database Redis Global
        const redis = new RedisClient();

        // --- DBeaver / Database Manager Component ---
        const DBManager = ({ onClose }) => {
            const [isLocked, setIsLocked] = useState(true); // Locked by default
            const [password, setPassword] = useState('');
            const [adminError, setAdminError] = useState('');

            const [keys, setKeys] = useState([]);
            const [selectedKey, setSelectedKey] = useState(null);
            const [editValue, setEditValue] = useState('');
            const [status, setStatus] = useState('Connected to Local Redis Simulation');
            const [showAdminPanel, setShowAdminPanel] = useState(false); // For adding new admins feature

            // --- SECURITY LOCK ---
            // In a real app, this would check against a secure backend or hash.
            // For simulation, we use a hardcoded 'admin123' or check a Redis key 'admin_secret'
            const handleUnlock = () => {
                const secret = redis.get('admin_secret', 'rama000102'); // Default password if not set
                if (password === secret) {
                    setIsLocked(false);
                    setAdminError('');
                    refreshKeys();
                } else {
                    setAdminError('Access Denied: Incorrect Admin Password');
                }
            };

            useEffect(() => {
                refreshKeys();
            }, []);

            const refreshKeys = () => {
                const allKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const k = localStorage.key(i);
                    if (k.startsWith(redis.prefix)) {
                        allKeys.push(k.replace(redis.prefix, ''));
                    }
                }
                setKeys(allKeys);
            };

            const handleSelect = (k) => {
                setSelectedKey(k);
                const val = redis.get(k);
                setEditValue(JSON.stringify(val, null, 2));
            };

            const handleSave = () => {
                try {
                    const parsed = JSON.parse(editValue);
                    redis.set(selectedKey, parsed);
                    setStatus(`Saved key: ${selectedKey}`);
                    setTimeout(() => setStatus('Ready'), 2000);
                } catch (e) {
                    alert('Invalid JSON Format!');
                }
            };

            const handleDelete = () => {
                if (confirm(`Delete key ${selectedKey}?`)) {
                    redis.del(selectedKey);
                    setSelectedKey(null);
                    setEditValue('');
                    refreshKeys();
                }
            };

            const handleExport = () => {
                const dump = {};
                keys.forEach(k => {
                    dump[k] = redis.get(k);
                });
                const blob = new Blob([JSON.stringify(dump, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `redis_dump_${new Date().toISOString()}.json`;
                a.click();
            };

            if (isLocked) {
                return (
                    <div className="db-overlay" style={{ alignItems: 'center', justifyContent: 'center' }}>
                        <div className="animate" style={{
                            width: '100%', maxWidth: 360, background: '#1e1e1e', padding: 30, borderRadius: 16,
                            border: '1px solid #333', boxShadow: '0 20px 50px rgba(0,0,0,0.5)', textAlign: 'center'
                        }}>
                            <div style={{ fontSize: 40, marginBottom: 20 }}>ðŸ”’</div>
                            <h2 style={{ fontSize: 20, color: 'white', marginBottom: 10 }}>Database Locked</h2>
                            <p style={{ color: '#aaa', fontSize: 13, marginBottom: 24 }}>
                                Security Protocol Active. Only authorized root administrators can access the raw database layer.
                            </p>

                            <input
                                type="password"
                                placeholder="Enter Admin Password"
                                value={password}
                                onChange={e => setPassword(e.target.value)}
                                style={{
                                    width: '100%', padding: '12px', borderRadius: 8, border: '1px solid #333',
                                    background: '#2b2b2b', color: 'white', marginBottom: 12, outline: 'none'
                                }}
                            />
                            {adminError && <div style={{ color: '#ff6b6b', fontSize: 12, marginBottom: 12 }}>{adminError}</div>}

                            <div style={{ display: 'flex', gap: 10 }}>
                                <button onClick={onClose} style={{ flex: 1, padding: 12, background: 'transparent', border: '1px solid #333', color: '#aaa', borderRadius: 8, cursor: 'pointer' }}>Cancel</button>
                                <button onClick={handleUnlock} style={{ flex: 1, padding: 12, background: '#6366f1', border: 'none', color: 'white', borderRadius: 8, fontWeight: 'bold', cursor: 'pointer' }}>Unlock</button>
                            </div>
                            <div style={{ marginTop: 20, fontSize: 11, color: '#555' }}>Default Debug Pass: admin123</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="db-overlay">
                    {/* DBeaver-like Toolbar */}
                    <div style={{ height: 40, background: '#3c3f41', display: 'flex', alignItems: 'center', padding: '0 10px', borderBottom: '1px solid #111', gap: 10, flexShrink: 0 }}>
                        <div style={{ fontWeight: 'bold', color: '#fff', marginRight: 'auto' }}>ðŸ¦« DBeaver Lite <span style={{ fontSize: 10, opacity: 0.7 }}>(Secured)</span></div>
                        <button onClick={() => setShowAdminPanel(!showAdminPanel)} style={{ background: showAdminPanel ? '#4a4d50' : 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: '6px 12px', borderRadius: 4, fontSize: 12 }}>
                            ðŸ‘¤ Manage Admins
                        </button>
                        <button onClick={refreshKeys} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', title: 'Refresh', padding: 8 }}>ðŸ”„</button>
                        <button onClick={handleExport} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', title: 'Export', padding: 8 }}>â¬‡ï¸</button>
                        <button onClick={onClose} style={{ background: '#d32f2f', color: 'white', border: 'none', padding: '4px 12px', borderRadius: 4, cursor: 'pointer' }}>Exit</button>
                    </div>

                    {showAdminPanel && (
                        <div style={{ padding: 16, background: '#252526', borderBottom: '1px solid #111' }}>
                            <h4 style={{ margin: '0 0 10px 0', color: '#fff' }}>Admin Access Management</h4>
                            <div style={{ display: 'flex', gap: 10, alignItems: 'center' }}>
                                <input type="text" placeholder="New Admin Secret..." style={{ padding: 6, background: '#1e1e1e', border: '1px solid #333', color: '#fff' }} id="newAdminSecretFn" />
                                <button onClick={() => {
                                    const val = document.getElementById('newAdminSecretFn').value;
                                    if (val) {
                                        redis.set('admin_secret', val);
                                        alert('New Admin Secret Set!');
                                        setShowAdminPanel(false);
                                    }
                                }} style={{ padding: '6px 12px', background: '#10B981', color: 'white', border: 'none', cursor: 'pointer' }}>Update Secret</button>
                            </div>
                            <div style={{ fontSize: 11, color: '#aaa', marginTop: 8 }}>Note: This will replace the master password for all admins.</div>
                        </div>
                    )}

                    <div className="db-layout">
                        {/* Sidebar Keys */}
                        <div className="db-sidebar">
                            <div style={{ padding: 8, background: '#3c3f41', fontWeight: 'bold', fontSize: 12 }}>Explorer</div>
                            <div style={{ flex: 1, overflowY: 'auto' }}>
                                {keys.map(k => (
                                    <div key={k} onClick={() => handleSelect(k)} style={{
                                        padding: '8px 10px', fontSize: 13, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6,
                                        background: selectedKey === k ? '#0d293e' : 'transparent',
                                        color: selectedKey === k ? '#fff' : '#aaa',
                                        borderBottom: '1px solid #3a3a3a'
                                    }}>
                                        <span style={{ color: '#e67e22' }}>ðŸ”‘</span> {k}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Editor Area */}
                        <div className="db-editor">
                            {selectedKey ? (
                                <>
                                    <div style={{ height: 36, background: '#313335', display: 'flex', alignItems: 'center', padding: '0 10px', gap: 10, borderBottom: '1px solid #111', flexShrink: 0 }}>
                                        <span style={{ fontWeight: 'bold', color: '#fff', fontSize: 12, overflow: 'hidden', whiteSpace: 'nowrap', textOverflow: 'ellipsis', maxWidth: 150 }}>{selectedKey}</span>
                                        <button onClick={handleSave} style={{ marginLeft: 'auto', padding: '4px 12px', background: '#2f6b55', border: 'none', color: 'white', cursor: 'pointer', fontSize: 12 }}>ðŸ’¾</button>
                                        <button onClick={handleDelete} style={{ padding: '4px 12px', background: '#8c2d2d', border: 'none', color: 'white', cursor: 'pointer', fontSize: 12 }}>ðŸ—‘ï¸</button>
                                    </div>
                                    <textarea
                                        value={editValue}
                                        onChange={e => setEditValue(e.target.value)}
                                        style={{
                                            flex: 1, width: '100%', background: '#1e1e1e', color: '#d4d4d4', border: 'none', padding: 10,
                                            fontFamily: 'Consolas, monospace', fontSize: 14, resize: 'none', outline: 'none'
                                        }}
                                        spellCheck="false"
                                    />
                                </>
                            ) : (
                                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#555', padding: 20, textAlign: 'center' }}>
                                    Select a key to view
                                </div>
                            )}
                            <div style={{ height: 24, background: '#007acc', color: 'white', fontSize: 11, display: 'flex', alignItems: 'center', padding: '0 10px', flexShrink: 0 }}>
                                {status}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- RBAC SYSTEM (Role-Based Access Control) ---
        const ROLES = {
            ADMIN: 'Admin',
            STAFF: 'Staff',
            USER: 'User'
        };

        const PERMISSIONS = {
            [ROLES.ADMIN]: ['create_user', 'edit_user', 'delete_user', 'view_report', 'view_profile'],
            [ROLES.STAFF]: ['view_report', 'view_profile'],
            [ROLES.USER]: ['view_profile']
        };

        // Helper untuk cek permission
        const checkPermission = (role, action) => {
            const rolePermissions = PERMISSIONS[role] || [];
            if (role === ROLES.ADMIN) return true; // Super admin bypass
            return rolePermissions.includes(action);
        };

        // Global Categories Data (Shared)
        const CATEGORIES_DATA = [
            { name: 'Hardware', icon: 'ðŸ–¥ï¸', color: '#3B82F6' },
            { name: 'Software', icon: 'ðŸ’¿', color: '#8B5CF6' },
            { name: 'Network', icon: 'ðŸŒ', color: '#10B981' },
            { name: 'Security', icon: 'ðŸ›¡ï¸', color: '#EF4444' },
            { name: 'Database', icon: 'ðŸ—„ï¸', color: '#F59E0B' },
            { name: 'Development', icon: 'âš¡', color: '#EC4899' },
            { name: 'Runtimes', icon: 'ðŸš€', color: '#F59E0B' },
            { name: 'Cloud', icon: 'â˜ï¸', color: '#0EA5E9' }
        ];

        // --- MAIN APP ---
        function App() {
            // Always force splash screen on first load
            const [screen, setScreen] = useState('splash');
            const [onboardingStep, setOnboardingStep] = useState(0);

            // State Initialization via Redis Database
            const [tab, setTab] = useState(() => redis.get('tab', 'home'));
            const [userName, setUserName] = useState(() => redis.get('userName', ''));
            const [userRole, setUserRole] = useState(() => redis.get('userRole', 'Admin')); // Default: Admin
            const [isPrivate, setIsPrivate] = useState(() => redis.get('isPrivate', false));
            const [selectedBidang, setSelectedBidang] = useState(null);

            // Load Knowledge Base & Category Data from Redis
            // Load Knowledge Base & Category Data from Redis
            const [knowledge, setKnowledge] = useState(() => redis.get('knowledge', KNOWLEDGE_BASE));
            const [categoryData, setCategoryData] = useState(() => redis.get('categoryData', {}));
            const [notifications, setNotifications] = useState(() => redis.get('notifications', [
                { id: 1, title: 'Selamat Datang', desc: 'Sistem siap digunakan.', time: 'Baru saja', type: 'info', target: 'home' }
            ]));

            // Redis Persistence Effect (Auto-Save)
            useEffect(() => {
                redis.set('screen', screen);
                redis.set('tab', tab);
                redis.set('userName', userName);
                redis.set('userRole', userRole);
                redis.set('isPrivate', isPrivate);
                redis.set('knowledge', knowledge);
                redis.set('categoryData', categoryData);
                redis.set('notifications', notifications);
            }, [screen, tab, userName, isPrivate, knowledge, categoryData, notifications]);

            const addNotification = (notif) => {
                const newNotif = { ...notif, id: Date.now(), time: 'Baru saja', unread: true };
                setNotifications(prev => [newNotif, ...prev]);
            };

            const handleNotificationClick = (n) => {
                if (n.target === 'bidang') {
                    const targetBidang = CATEGORIES_DATA.find(c => c.name === n.targetId);
                    if (targetBidang) {
                        setSelectedBidang(targetBidang);
                        setTab('home'); // Pastikan tab home aktif karena BidangDetail di render di sana
                    }
                } else {
                    setTab(n.target || 'home');
                }
            };

            const handleAddKnowledge = (newItem) => {
                setKnowledge(prev => {
                    if (prev.find(k => k.id === newItem.id)) return prev;
                    return [newItem, ...prev];
                });
            };

            const handleUpdateCategoryData = (name, data) => {
                if (!name) return;
                setCategoryData(prev => ({
                    ...prev,
                    [name]: data
                }));
            };

            const getCategoryData = (name) => {
                if (!name) return { discussions: [], chatMessages: [], materials: [] };
                return categoryData[name] || {
                    discussions: [
                        { user: "Rudi Tabuti", title: `Optimasi performa di ${name}`, tags: [name], comments: 5 },
                        { user: "Sari Roti", title: `Standard Operating Procedure (SOP) ${name}`, tags: ["Work", name], comments: 2 }
                    ],
                    chatMessages: [
                        { user: "Andi", text: "Izin bertanya pak, untuk implementasi terbaru baiknya pakai framework apa?", time: "10:05" },
                        { user: "Budi Santoso", text: "Untuk case Anda, saya sarankan menggunakan pendekatan modular.", time: "10:12" }
                    ],
                    materials: [
                        { id: 1, title: `Panduan Utama ${name}`, update: 'Jan 2026', type: 'PDF', discussions: 12, likes: 24, isLiked: false, url: '#' }
                    ]
                };
            };

            const getCategoryCount = (name) => {
                const data = getCategoryData(name);
                return data.discussions.length;
            };

            const handleOnboardingNext = () => {
                if (onboardingStep < 2) {
                    setOnboardingStep(onboardingStep + 1);
                } else {
                    setScreen('auth');
                }
            };

            const handleLogin = (name) => {
                if (!name) { alert('Mohon isi nama Anda'); return; }
                setUserName(name);
                setScreen('main');
                // Sync to Redis
                redis.set('userName', name);
                redis.set('screen', 'main');
            };

            const handleLogout = () => {
                if (confirm('Apakah Anda yakin ingin keluar? Semua sesi akan dibersihkan demi keamanan.')) {
                    setUserName('');
                    setScreen('auth');
                    setTab('home');
                    // Secure Redis Flush
                    redis.flushdb();
                    window.location.reload();
                }
            };

            // Splash Screen
            if (screen === 'splash') {
                return <Splash onFinish={() => setScreen('onboarding')} />;
            }

            // Onboarding Screen
            if (screen === 'onboarding') {
                return <Onboarding step={onboardingStep} onNext={handleOnboardingNext} />;
            }

            // Auth Screen
            if (screen === 'auth') {
                return <Auth onLogin={handleLogin} />;
            }

            // Main App
            return (
                <div style={{ display: 'flex', width: '100%' }}>
                    {/* DBeaver Overlay */}
                    {screen === 'db_manager' && <DBManager onClose={() => setScreen('main')} />}

                    {/* Desktop Sidebar */}
                    <div className="sidebar">
                        <div style={{ marginBottom: 40, padding: '0 12px', textAlign: 'center', position: 'relative' }}>
                            <div className="logo-container" style={{
                                width: 120,
                                height: 120,
                                margin: '0 auto',
                                borderRadius: '50%', // Make it circular/soft
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                background: 'radial-gradient(circle at center, rgba(255,215,0,0.15) 0%, transparent 70%)', // Inner gold glow
                                boxShadow: '0 0 30px rgba(255, 165, 0, 0.2)', // Outer glow
                                transition: 'transform 0.3s ease',
                                cursor: 'pointer'
                            }}
                                onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
                                onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
                            >
                                <img src="MR.png" alt="MR Tech" style={{
                                    width: '100%',
                                    height: '100%',
                                    objectFit: 'contain',
                                    filter: 'drop-shadow(0 4px 8px rgba(0,0,0,0.4))',
                                    borderRadius: '50%'
                                }} />
                            </div>
                        </div>
                        <div className={`nav-item ${tab === 'home' ? 'active' : ''}`} data-menu="home" onClick={() => { setTab('home'); setSelectedBidang(null); }}>
                            <Icon name="home" />
                            <span>Beranda</span>
                        </div>
                        <div className={`nav-item ${tab === 'bidang' ? 'active' : ''}`} data-menu="bidang" onClick={() => setTab('bidang')}>
                            <Icon name="grid" />
                            <span>Bidang</span>
                        </div>
                        <div className={`nav-item ${tab === 'pesan' ? 'active' : ''}`} data-menu="pesan" onClick={() => setTab('pesan')}>
                            <Icon name="message-circle" />
                            <span>Pesan</span>
                        </div>
                        <div className={`nav-item ${tab === 'anggota' ? 'active' : ''}`} data-menu="anggota" onClick={() => setTab('anggota')}>
                            <Icon name="users" />
                            <span>Anggota</span>
                        </div>
                        <div className={`nav-item ${tab === 'notif' ? 'active' : ''}`} data-menu="notif" onClick={() => setTab('notif')}>
                            <Icon name="bell" />
                            <span>Notifikasi</span>
                        </div>
                        <div className={`nav-item ${tab === 'profil' ? 'active' : ''}`} data-menu="profil" onClick={() => setTab('profil')}>
                            <Icon name="user" />
                            <span>Profil</span>
                        </div>
                    </div>

                    {/* Main Mobile/Desktop Content Area - Optimized for Instant Switching (No Loading) */}
                    <div className="main-content">
                        {/* Home & Bidang Detail Layer */}
                        <div style={{ display: tab === 'home' ? 'block' : 'none' }}>
                            {selectedBidang ? (
                                <BidangDetail
                                    bidang={selectedBidang}
                                    onBack={() => setSelectedBidang(null)}
                                    currentUserName={userName}
                                    onAddKnowledge={handleAddKnowledge}
                                    categoryData={getCategoryData(selectedBidang.name)}
                                    onUpdateCategoryData={handleUpdateCategoryData}
                                />
                            ) : (
                                <Home
                                    userName={userName}
                                    userRole={userRole} // Pass role to Home
                                    checkPermission={(action) => checkPermission(userRole, action)} // Pass checker
                                    onCreateQuestion={() => {
                                        if (checkPermission(userRole, 'create_user')) {
                                            alert('Access Granted: Membuka Form Create Question (Admin/Privileged).');
                                        } else {
                                            alert('Access Denied: Anda tidak memiliki izin untuk membuat pertanyaan global.');
                                        }
                                    }}
                                    onBidangClick={(bidang) => setSelectedBidang(bidang)}
                                    onNavigate={(target) => setTab(target)}
                                    onOpenDB={() => setScreen('db_manager')}
                                    onLogout={handleLogout}
                                    knowledgeBase={knowledge}
                                    getCategoryCount={getCategoryCount}
                                />
                            )}
                        </div>

                        {/* Bidang Layer */}
                        <div style={{ display: tab === 'bidang' ? 'block' : 'none' }}>
                            {selectedBidang ? (
                                <BidangDetail
                                    bidang={selectedBidang}
                                    onBack={() => setSelectedBidang(null)}
                                    currentUserName={userName}
                                    onAddKnowledge={handleAddKnowledge}
                                    categoryData={getCategoryData(selectedBidang.name)}
                                    onUpdateCategoryData={handleUpdateCategoryData}
                                    addNotification={addNotification}
                                />
                            ) : (
                                <Bidang
                                    onBidangClick={(bidang) => setSelectedBidang(bidang)}
                                    getCategoryCount={getCategoryCount}
                                />
                            )}
                        </div>

                        {/* Persistent Tabs (Instant Access) */}
                        <div style={{ display: tab === 'pesan' ? 'block' : 'none' }}><Pesan userName={userName} onNavigate={(target) => setTab(target)} /></div>
                        <div style={{ display: tab === 'anggota' ? 'block' : 'none' }}><Anggota isPrivateMode={isPrivate} /></div>
                        <div style={{ display: tab === 'notif' ? 'block' : 'none' }}>
                            <Notifikasi
                                onNavigate={(target) => setTab(target)}
                                notifications={notifications}
                                onNotificationClick={handleNotificationClick}
                            />
                        </div>
                        <div style={{ display: tab === 'profil' ? 'block' : 'none' }}>
                            <Profil
                                userName={userName}
                                userRole={userRole}
                                isPrivate={isPrivate}
                                onTogglePrivate={() => setIsPrivate(!isPrivate)}
                                onLogout={handleLogout}
                                onNavigate={(target) => setTab(target)}
                            />
                        </div>
                        <div style={{ display: tab === 'bantuan' ? 'block' : 'none' }}><Bantuan onNavigate={(target) => setTab(target)} /></div>
                        <div style={{ display: tab === 'pengetahuan' ? 'block' : 'none' }}><KnowledgeFeed onBack={() => setTab('home')} knowledgeBase={knowledge} /></div>
                    </div>

                    {/* Mobile Bottom Nav */}
                    <div className="bottom-nav">
                        <div className={`nav-item ${tab === 'home' ? 'active' : ''}`} data-menu="home" onClick={() => { setTab('home'); setSelectedBidang(null); }}>
                            <Icon name="home" />
                            <span>Beranda</span>
                        </div>
                        <div className={`nav-item ${tab === 'bidang' ? 'active' : ''}`} data-menu="bidang" onClick={() => setTab('bidang')}>
                            <Icon name="grid" />
                            <span>Bidang</span>
                        </div>
                        <div className={`nav-item ${tab === 'pesan' ? 'active' : ''}`} data-menu="pesan" onClick={() => setTab('pesan')}>
                            <Icon name="message-circle" />
                            <span>Pesan</span>
                        </div>
                        <div className={`nav-item ${tab === 'anggota' ? 'active' : ''}`} data-menu="anggota" onClick={() => setTab('anggota')}>
                            <Icon name="users" />
                            <span>Anggota</span>
                        </div>
                        <div className={`nav-item ${tab === 'notif' ? 'active' : ''}`} data-menu="notif" onClick={() => setTab('notif')}>
                            <Icon name="bell" />
                            <span>Notifikasi</span>
                        </div>
                        <div className={`nav-item ${tab === 'profil' ? 'active' : ''}`} data-menu="profil" onClick={() => setTab('profil')}>
                            <Icon name="user" />
                            <span>Profil</span>
                        </div>
                    </div>
                </div>
            );
        }

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (error) {
            console.error("React Render Error:", error);
            document.body.innerHTML += '<div style="color: red; padding: 20px;"><h3>React Gagal Dirender:</h3><pre>' + error.message + '</pre></div>';
        }
    </script>
</body>

</html>